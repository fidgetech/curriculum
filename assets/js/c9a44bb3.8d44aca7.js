"use strict";(self.webpackChunklhtp=self.webpackChunklhtp||[]).push([[80783],{28453:(e,n,a)=>{a.d(n,{R:()=>s,x:()=>r});var t=a(96540);const i={},o=t.createContext(i);function s(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),t.createElement(o.Provider,{value:n},e.children)}},43055:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"c-and-net/building-an-api/5-6-0-09-adding-api-model-validation","title":"\ud83d\udcd3 5.6.0.09 Adding API Model Validation","description":"In this lesson, we\'ll learn how to add validation to our models. Some of this information will be a review, since we\'re already familiar with adding validation attributes to our models in MVC apps, and this process is no different with APIs. However, we\'ll review some new information on how model validation is actually performed in API controllers.","source":"@site/versioned_docs/version-WIP/c-and-net/6_building-an-api/3-6-0-09-adding-api-model-validation.md","sourceDirName":"c-and-net/6_building-an-api","slug":"/c-and-net/building-an-api/5-6-0-09-adding-api-model-validation","permalink":"/WIP/c-and-net/building-an-api/5-6-0-09-adding-api-model-validation","draft":false,"unlisted":false,"tags":[],"version":"WIP","frontMatter":{"title":"\ud83d\udcd3 5.6.0.09 Adding API Model Validation","day":"weekend","id":"5-6-0-09-adding-api-model-validation","hide_table_of_contents":true},"sidebar":"c-and-net","previous":{"title":"\ud83d\udcd3 5.6.0.08 Adding Parameters to a Get Request to Support Query Strings","permalink":"/WIP/c-and-net/building-an-api/5-6-0-08-adding-parameters-to-a-get-request-to-support-query-strings"},"next":{"title":"\ud83d\udcd3 5.6.0.10 Scaffolding API Controllers","permalink":"/WIP/c-and-net/building-an-api/5-6-0-10-scaffolding-api-controllers"}}');var i=a(74848),o=a(28453);const s={title:"\ud83d\udcd3 5.6.0.09 Adding API Model Validation",day:"weekend",id:"5-6-0-09-adding-api-model-validation",hide_table_of_contents:!0},r=void 0,d={},l=[{value:"Adding Model Validation",id:"adding-model-validation",level:2},{value:"Error Messages",id:"error-messages",level:3},{value:"Updating Controllers to Handle Model Validation",id:"updating-controllers-to-handle-model-validation",level:3},{value:"EF Core Code-First Data Annotations",id:"ef-core-code-first-data-annotations",level:3},{value:"More Resources and External Validation Libraries",id:"more-resources-and-external-validation-libraries",level:3}];function c(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"In this lesson, we'll learn how to add validation to our models. Some of this information will be a review, since we're already familiar with adding validation attributes to our models in MVC apps, and this process is no different with APIs. However, we'll review some new information on how model validation is actually performed in API controllers."}),"\n",(0,i.jsx)(n.p,{children:"We won't update the Cretaceous Park API to include model validation. Instead this will be further exploration for you to do in your projects in class."}),"\n",(0,i.jsx)(n.h2,{id:"adding-model-validation",children:"Adding Model Validation"}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.p,{children:"We can easily add a few basic validations to either an MVC web application or an API. The .NET MVC framework provides several built-in data annotations that we can add to a model. Specifically, we can add one of the following validations to a model:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"[Required]"}),": Makes a field required."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"[StringLength]"}),": Determines a maximum length for a string."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"[Range]"}),": Determines a maximum and minimum for a numeric field."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Here's how we might incorporate them into our ",(0,i.jsx)(n.code,{children:"Animal"})," class:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'using System.ComponentModel.DataAnnotations;\n\nnamespace CretaceousPark.Models\n{\n  public class Animal\n  {\n    public int AnimalId { get; set; }\n    [Required]\n    [StringLength(20)]\n    public string Name { get; set; }\n    [Required]\n    public string Species { get; set; }\n    [Required]\n    [Range(0, 200, ErrorMessage = "Age must be between 0 and 200.")]\n    public int Age { get; set; }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["We add ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/system.componentmodel.dataannotations?view=net-6.0",children:(0,i.jsx)(n.code,{children:"using System.ComponentModel.DataAnnotations;"})})," in order to access data annotations like validation attributes."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["We add the ",(0,i.jsx)(n.code,{children:"[Required]"})," annotation for any fields that should be required in our application."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["We specify that a ",(0,i.jsx)(n.code,{children:"Name"})," can't be longer than twenty characters with ",(0,i.jsx)(n.code,{children:"[StringLength(20)]"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["We provide a ",(0,i.jsx)(n.code,{children:"Range"})," between 0 and 200 for ",(0,i.jsx)(n.code,{children:"Age"}),". Note that we can also add a custom error message with ",(0,i.jsx)(n.code,{children:"ErrorMessage"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"error-messages",children:"Error Messages"}),"\n",(0,i.jsxs)(n.p,{children:["If we don't provide a custom message, our API will provide its own error message. For instance, if we make a POST call where the ",(0,i.jsx)(n.code,{children:"Name"})," property is more than twenty characters, we'll get the following response:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "errors": {\n        "Name": [\n            "The field Name must be a string with a maximum length of 20."\n        ]\n    },\n    "title": "One or more validation errors occurred.",\n    "status": 400,\n    "traceId": "0HLOLVJT60FKC:00000001"\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"updating-controllers-to-handle-model-validation",children:"Updating Controllers to Handle Model Validation"}),"\n",(0,i.jsxs)(n.p,{children:["With API controllers that are marked with the ",(0,i.jsx)(n.code,{children:"[ApiController]"})," attribute, we ",(0,i.jsx)(n.strong,{children:"do not"})," need to update our controllers to check ",(0,i.jsx)(n.code,{children:"ModelState"})," like we did in our MVC apps, something like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"      if (!ModelState.IsValid)\n      {\n        return View();\n      }\n      else\n      {\n        ...\n      }\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This is because all controllers that have the ",(0,i.jsx)(n.code,{children:"[ApiController]"})," attribute perform automatic model validation checking, and automatically handle returning a 400 Bad Request status code along with an error message as the API's response."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/aspnet/core/web-api/?view=aspnetcore-6.0#automatic-http-400-responses",children:"To learn more about this, visit the official documentation."})}),"\n",(0,i.jsx)(n.h3,{id:"ef-core-code-first-data-annotations",children:"EF Core Code-First Data Annotations"}),"\n",(0,i.jsxs)(n.p,{children:["Finally, keep in mind that some data annotations in the ",(0,i.jsx)(n.code,{children:"System.ComponentModel.DataAnnotations"})," namespace overlap with ",(0,i.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/ef/ef6/modeling/code-first/data-annotations",children:"data annotations that we can use on our EF Core models in code-first development"}),". A good example is the ",(0,i.jsx)(n.code,{children:"[required]"})," attribute, which will make a model property required in our .NET app (MVC or API), as well as, update our database field to be non-nullable (required)."]}),"\n",(0,i.jsxs)(n.p,{children:["So as a precaution after you add validation attributes to your model properties, you should create a new migration and see if any changes are made to the database entities, and if so, determine whether or not you want those changes applied to your database. (Remember that you can always reverse the last migration with ",(0,i.jsx)(n.code,{children:"dotnet ef migrations remove"}),".)"]}),"\n",(0,i.jsx)(n.p,{children:"Typically the requirements that we add to our project models, we'll also want applied to our database. However, if you don't want the changes applied to your database, use a ViewModel to separate the database entity model from the ViewModel that you use to handle incoming requests and validate them."}),"\n",(0,i.jsxs)(n.p,{children:["Use a ViewModel for an API? Yes, and no. The concept is similar to a ViewModel \u2014 we're creating a model to use for something other than describing our database entity models. But for APIs, this would be for validating a request instead of being used to shape and validate data used in a view. Because of this, it's best to use a different name than ViewModel; perhaps we could call it a RequestModel instead. To learn more about this topic, check out this interesting discussion in ",(0,i.jsx)(n.a,{href:"https://softwareengineering.stackexchange.com/questions/399508/is-creating-viewmodels-in-web-api-a-bad-practice",children:"this Stack Exchange thread"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"more-resources-and-external-validation-libraries",children:"More Resources and External Validation Libraries"}),"\n",(0,i.jsx)(n.p,{children:"While these basic validations are helpful, there are many other validations we might want to use that .NET doesn't provide. In that situation, we can consider custom validations or use an external library."}),"\n",(0,i.jsxs)(n.p,{children:["For more information on both custom validations and validations in general, check out the ",(0,i.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/aspnet/core/mvc/models/validation?view=aspnetcore-6.0",children:"official documentation"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["If you are interested in exploring an external library, check out ",(0,i.jsx)(n.a,{href:"https://fluentvalidation.net/aspnet",children:"FluentValidation"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);
"use strict";(self.webpackChunklhtp=self.webpackChunklhtp||[]).push([[12063],{28453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var i=s(96540);const t={},a=i.createContext(t);function o(e){const n=i.useContext(a);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(a.Provider,{value:n},e.children)}},66562:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"c-and-net/authentication-with-identity/3-5-0-2-async-and-await","title":"\ud83d\udcd3 3.5.0.2 Async and Await","description":"During Intermediate JavaScript, we learned how to write asynchronous code and manage asynchronicity while performing complex actions like API calls. In this lesson, we\'ll discuss how C# handles asynchronous code.","source":"@site/docs/3_c-and-net/5_authentication-with-identity/3-5-0-02-async-and-await.md","sourceDirName":"3_c-and-net/5_authentication-with-identity","slug":"/c-and-net/authentication-with-identity/3-5-0-2-async-and-await","permalink":"/v1.2/c-and-net/authentication-with-identity/3-5-0-2-async-and-await","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"\ud83d\udcd3 3.5.0.2 Async and Await","day":"weekend","id":"3-5-0-2-async-and-await","hide_table_of_contents":true},"sidebar":"c-and-net","previous":{"title":"\ud83d\udcd3 3.5.0.1 Authentication with Identity Objectives","permalink":"/v1.2/c-and-net/authentication-with-identity/3-5-0-1-authentication-with-identity-objectives"},"next":{"title":"\ud83d\udcd3 3.5.0.3 Introduction to Authentication, Authorization, and Identity","permalink":"/v1.2/c-and-net/authentication-with-identity/3-5-0-3-introduction-to-authentication-authorization-and-identity"}}');var t=s(74848),a=s(28453);const o={title:"\ud83d\udcd3 3.5.0.2 Async and Await",day:"weekend",id:"3-5-0-2-async-and-await",hide_table_of_contents:!0},c=void 0,r={},d=[{value:"Synchronous Operations",id:"synchronous-operations",level:2},{value:"Asynchronous Operations",id:"asynchronous-operations",level:2},{value:"Rules and Conventions",id:"rules-and-conventions",level:3},{value:"Namespace",id:"namespace",level:3},{value:"Additional Resources",id:"additional-resources",level:2}];function l(e){const n={a:"a",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"During Intermediate JavaScript, we learned how to write asynchronous code and manage asynchronicity while performing complex actions like API calls. In this lesson, we'll discuss how C# handles asynchronous code."}),"\n",(0,t.jsx)(n.p,{children:"Why is this relevant now? In the next few lessons, we'll learn how to authenticate users with Identity. This will require our applications to manage asynchronous actions, so we need to learn how to recognize and write asynchronous methods."}),"\n",(0,t.jsx)(n.h2,{id:"synchronous-operations",children:"Synchronous Operations"}),"\n",(0,t.jsxs)(n.p,{children:["So far the C# code we've written is ",(0,t.jsx)(n.strong,{children:"synchronous"})," and our code executes a single line at a time. The ",(0,t.jsx)(n.code,{children:"Edit()"})," action in the ",(0,t.jsx)(n.code,{children:"ItemsController.cs"})," is an example of a synchronous method:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'...\n    public ActionResult Edit(int id)\n    {\n      Item thisItem = _db.Items.FirstOrDefault(item => item.ItemId == id);\n      ViewBag.CategoryId = new SelectList(_db.Categories, "CategoryId", "Name");\n      return View(thisItem);\n    }\n...\n'})}),"\n",(0,t.jsx)(n.p,{children:"Let's walk through what occurs when this synchronous method is called:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["When ",(0,t.jsx)(n.code,{children:"Edit()"})," is called, our program looks in the database to find a specific item."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["After locating the item, our program returns the Edit ",(0,t.jsx)(n.code,{children:"View()"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["While our program is looking in the database, the browser waits. It cannot return the view until ",(0,t.jsx)(n.code,{children:"thisItem"})," is found because the line of code attempting to locate ",(0,t.jsx)(n.code,{children:"thisItem"})," appears ",(0,t.jsx)(n.em,{children:"before"})," we return the view."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["When ",(0,t.jsx)(n.code,{children:"thisItem"})," is located, the application can return the view to be displayed in the browser."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Because the lines of code are executed in order, this is a ",(0,t.jsx)(n.strong,{children:"synchronous"})," operation."]}),"\n",(0,t.jsx)(n.h2,{id:"asynchronous-operations",children:"Asynchronous Operations"}),"\n",(0,t.jsxs)(n.p,{children:["On the other hand, an ",(0,t.jsx)(n.strong,{children:"asynchronous"}),' (also, "async") operation allows other code to run while a method is waiting to return.\nThis is very similar to what we learned in JavaScript. However, the code we write to manage this process looks much different.']}),"\n",(0,t.jsx)(n.p,{children:"There are three primary parts to an async C# method:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"async"})," keyword"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"await"})," keyword"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["A special ",(0,t.jsx)(n.code,{children:"Task"})," class that represents an action or actions the program may not have completed yet because they're async."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Let's walk through an example async method:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'static async void ProcessTextFileAsync()\n{\n  Task<int> asyncTask = ExampleAsyncMethodThatTakesAWhile();\n\n  Console.WriteLine("Please wait patiently while I run the ExampleAsyncMethodThatTakesAWhile().");\n\n  int x = await asyncTask;\n\n  Console.WriteLine("Return value of ExampleAsyncMethodThatTakesAWhile(): " + x);\n}\n'})}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["First, the ",(0,t.jsx)(n.code,{children:"async"})," keyword is included in the method's signature: ",(0,t.jsx)(n.code,{children:"static async void ProcessTextFileAsync()"}),". Async methods should always have an ",(0,t.jsx)(n.code,{children:"async"})," modifier in their declaration. It tells our application the method should run asynchronously."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Next, notice the ",(0,t.jsx)(n.code,{children:"await"})," keyword in the line ",(0,t.jsx)(n.code,{children:"int x = await asyncTask"}),". As its name suggests, this keyword makes the application wait until the specified async action ",(0,t.jsx)(n.code,{children:"asyncTask"})," is completed. Once ",(0,t.jsx)(n.code,{children:"asyncTask"})," is completed, it will define ",(0,t.jsx)(n.code,{children:"x"}),'. This gives us a great deal of control over our code. We can allow multiple lines of code to run asynchronously and then add multiple "waiting points" with ',(0,t.jsx)(n.code,{children:"await"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Our hypothetical async method ",(0,t.jsx)(n.code,{children:"ExampleAsyncMethodThatTakesAWhile()"})," stores the return data in the variable ",(0,t.jsx)(n.code,{children:"asyncTask"}),". Notice that ",(0,t.jsx)(n.code,{children:"asyncTask"})," has the type of ",(0,t.jsx)(n.code,{children:"Task<int>"}),". In C#, ",(0,t.jsxs)(n.strong,{children:["an asynchronous method can only return ",(0,t.jsx)(n.code,{children:"void"})," or a ",(0,t.jsx)(n.code,{children:"Task"})," object representing the asynchronous operation itself."]})," A ",(0,t.jsx)(n.code,{children:"Task"})," represents ongoing work. While a ",(0,t.jsx)(n.code,{children:"Task"})," is ",(0,t.jsx)(n.code,{children:"void"})," by default, we can specify what type the task will eventually return by using the ",(0,t.jsx)(n.code,{children:"Task<TResult>"})," class. For example:"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Task<int>"})," returns an ",(0,t.jsx)(n.code,{children:"int"}),";"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Task<string>"})," returns a ",(0,t.jsx)(n.code,{children:"string"}),";"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Task<ActionResult>"})," returns an ",(0,t.jsx)(n.code,{children:"ActionResult"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.ol,{start:"4",children:["\n",(0,t.jsxs)(n.li,{children:["In the code above we want the result to be the integer ",(0,t.jsx)(n.code,{children:"x"}),". In order to turn a ",(0,t.jsx)(n.code,{children:"Task<int>"})," into an ",(0,t.jsx)(n.code,{children:"int"}),", we use the ",(0,t.jsx)(n.code,{children:"await"})," keyword. This forces the program to wait until ",(0,t.jsx)(n.code,{children:"task"})," is appropriately defined as an ",(0,t.jsx)(n.code,{children:"int"})," before moving on to subsequent lines of code."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Let's consider one more pseudocode example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-csharp",children:'static async void DoMyHolidayErrandsForMeAsync()\n{\n  Task<int> determineHowManyGiftsIShouldBuy = ProcessSantasList("C:\\\\naughty_or_nice.txt");\n  BakeSugarCookies();\n  HangLights();\n  int giftNumber = await determineHowManyGiftsIShouldBuy;\n  for (int index = 0; index < giftNumber; index++)\n  {\n    BuyHolidayGifts();\n    MarkOffList(index);\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Here, we have an ",(0,t.jsx)(n.code,{children:"async"})," method called ",(0,t.jsx)(n.code,{children:"DoMyHolidayErrandsForMeAsync()"}),". We could describe the method as doing the following: \"I need you to do holiday errands. Start determining how many gifts we need to buy and feel free to multi-task and bake the cookies and hang lights while you're doing that, too. But ",(0,t.jsx)(n.strong,{children:"wait"})," to define ",(0,t.jsx)(n.code,{children:"giftNumber"})," until after the ",(0,t.jsx)(n.code,{children:"ProcessSantasList()"}),' method fully finishes because we need its results before continuing. After we have that number, we can buy the necessary number of gifts and start marking them off our list."']}),"\n",(0,t.jsx)(n.h3,{id:"rules-and-conventions",children:"Rules and Conventions"}),"\n",(0,t.jsx)(n.p,{children:"Before we wrap up, let's review the rules and conventions for async methods in C#:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Async methods always have an ",(0,t.jsx)(n.code,{children:"async"})," modifier in their declaration, as seen above."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["It's also a best practice to include the term ",(0,t.jsx)(n.code,{children:"Async"})," at the end of the method name as seen in the ",(0,t.jsx)(n.code,{children:"ProcessTextFileAsync()"})," and ",(0,t.jsx)(n.code,{children:"DoMyHolidayErrandsForMeAsync()"})," methods."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Again, an asynchronous method can only return ",(0,t.jsx)(n.code,{children:"void"})," or a ",(0,t.jsx)(n.code,{children:"Task"})," object representing the asynchronous operation itself."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["We can specify what type the ",(0,t.jsx)(n.code,{children:"Task"})," will eventually become. For example, the type ",(0,t.jsx)(n.code,{children:"Task<int>"})," will resolve to an ",(0,t.jsx)(n.code,{children:"int"}),", ",(0,t.jsx)(n.code,{children:"Task<string>"})," returns a ",(0,t.jsx)(n.code,{children:"string"}),", and ",(0,t.jsx)(n.code,{children:"Task<ActionResult>"})," returns an ",(0,t.jsx)(n.code,{children:"ActionResult"}),". When we do this, we're using the ",(0,t.jsx)(n.code,{children:"Task<TResult>"})," class."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"await"})," keyword can ",(0,t.jsx)(n.strong,{children:"only"})," be used in a method that includes the ",(0,t.jsx)(n.code,{children:"async"})," modifier in its signature."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["Because ",(0,t.jsx)(n.code,{children:"await"})," waits for a ",(0,t.jsx)(n.code,{children:"Task"}),' to finish and return its specified data type, we can use it to "unwrap" a ',(0,t.jsx)(n.code,{children:"Task"}),". For instance, if we ",(0,t.jsx)(n.code,{children:"await"})," something declared as a ",(0,t.jsx)(n.code,{children:"Task<int>"}),", we'll receive an ",(0,t.jsx)(n.code,{children:"int"})," value, because that's what that ",(0,t.jsx)(n.code,{children:"Task"})," returns when its async code is finished running. Similarly, if we use ",(0,t.jsx)(n.code,{children:"await"})," on a ",(0,t.jsx)(n.code,{children:"Task<string>"}),", we'd receive a string value."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"namespace",children:"Namespace"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"Task"})," and ",(0,t.jsx)(n.code,{children:"Task<TResult>"})," classes belong to the ",(0,t.jsx)(n.code,{children:"System.Threading.Tasks"})," namespace. So anytime we use a ",(0,t.jsx)(n.code,{children:"Task"})," in our code, we'll need to add the following using directive."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cs",children:"using System.Threading.Tasks;\n"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"System.Threading.Tasks"})," namespace contains a lot of classes to help us manage concurrent and asynchronous code. To learn more, visit the ",(0,t.jsxs)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/system.threading.tasks?view=net-6.0",children:["MS Docs for the ",(0,t.jsx)(n.code,{children:"System.Threading.Tasks"})," namespace"]}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"additional-resources",children:"Additional Resources"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["To review the official guide on asynchrony with C#, visit the ",(0,t.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/async/",children:"MS docs on async and await"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["For some examples of async/await methods in use, check out ",(0,t.jsx)(n.a,{href:"http://www.dotnetperls.com/async",children:"this article from dotnetperls"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:["For more information about the ",(0,t.jsx)(n.code,{children:"Task<TResult>"})," class, we recommend the ",(0,t.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/system.threading.tasks.task-1?view=net-6.0",children:"MS Documentation"}),"."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}}}]);
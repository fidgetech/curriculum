"use strict";(self.webpackChunklhtp=self.webpackChunklhtp||[]).push([[21466],{28453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>a});var t=s(96540);const r={},o=t.createContext(r);function i(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:n},e.children)}},61223:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"intermediate-javascript/asynchrony-and-apis/2-3-1-4-promises-with-api-calls","title":"\ud83d\udcd3 2.3.1.4 Promises with API Calls","description":"Now that we\'ve learned about promises, we\'re ready to update our weather API code to use one. We will be using the same code that we used during the weekend homework \u2014 we\'ll only need to make changes in one file to incorporate promises in our project. Click the following link to get the code up to this point. Take note that this links to a branch called 1xhrapi_call, the default branch of this repo:","source":"@site/docs/2_intermediate-javascript/3_asynchrony-and-apis/2-3-1-04-promises-with-api-calls.md","sourceDirName":"2_intermediate-javascript/3_asynchrony-and-apis","slug":"/intermediate-javascript/asynchrony-and-apis/2-3-1-4-promises-with-api-calls","permalink":"/v1.2/intermediate-javascript/asynchrony-and-apis/2-3-1-4-promises-with-api-calls","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"\ud83d\udcd3 2.3.1.4 Promises with API Calls","day":"monday","id":"2-3-1-4-promises-with-api-calls","hide_table_of_contents":true},"sidebar":"intermediate-javascript","previous":{"title":"\ud83d\udcd3 2.3.1.3 Introduction to Promises","permalink":"/v1.2/intermediate-javascript/asynchrony-and-apis/2-3-1-3-introduction-to-promises"},"next":{"title":"\ud83d\udcd3 2.3.1.5 Static Methods and Properties","permalink":"/v1.2/intermediate-javascript/asynchrony-and-apis/2-3-1-5-static-methods-and-properties"}}');var r=s(74848),o=s(28453);const i={title:"\ud83d\udcd3 2.3.1.4 Promises with API Calls",day:"monday",id:"2-3-1-4-promises-with-api-calls",hide_table_of_contents:!0},a=void 0,c={},l=[{value:"Using a Promise with an API Call",id:"using-a-promise-with-an-api-call",level:2}];function d(e){const n={a:"a",code:"code",div:"div",h2:"h2",hr:"hr",i:"i",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Now that we've learned about promises, we're ready to update our weather API code to use one. We will be using the same code that we used during the weekend homework \u2014 we'll only need to make changes in one file to incorporate promises in our project. Click the following link to get the code up to this point. Take note that this links to a branch called ",(0,r.jsx)(n.code,{children:"1_xhr_api_call"}),", the default branch of this repo:"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:(0,r.jsxs)(n.a,{href:"https://github.com/epicodus-lessons/section-6-js-api-call-with-webpack",children:[(0,r.jsx)(n.i,{className:"glyphicon glyphicon-folder-open"}),"  Example GitHub Repo for Project"]})})}),"\n",(0,r.jsx)(n.h2,{id:"using-a-promise-with-an-api-call",children:"Using a Promise with an API Call"}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:["The only file we'll need to update is ",(0,r.jsx)(n.code,{children:"index.js"}),". We'll start by providing the code, and then we'll walk through the changes."]}),"\n",(0,r.jsx)(n.div,{className:"filename",children:"src/index.js"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"import 'bootstrap';\nimport 'bootstrap/dist/css/bootstrap.min.css';\nimport './css/styles.css';\n\n// Business Logic\n\nfunction getWeather(city) {\n  let promise = new Promise(function(resolve, reject) {\n    let request = new XMLHttpRequest();\n    const url = `http://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${process.env.API_KEY}`;\n    request.addEventListener(\"loadend\", function() {\n      const response = JSON.parse(this.responseText);\n      if (this.status === 200) {\n        resolve([response, city]);\n      } else {\n        reject([this, response, city]);\n      }\n    });\n    request.open(\"GET\", url, true);\n    request.send();\n  });\n\n  promise.then(function(response) {\n    printElements(response);\n  }, function(errorMessage) {\n    printError(errorMessage);\n  });\n}\n\n// UI Logic\n\nfunction printElements(results) {\n  document.querySelector('#showResponse').innerText = `The humidity in ${results[1]} is ${results[0].main.humidity}%.\n  The temperature in Kelvins is ${results[0].main.temp} degrees.`;\n}\n\nfunction printError(error) {\n  document.querySelector('#showResponse').innerText = `There was an error accessing the weather data for ${error[2]}: ${error[0].status} ${error[0].statusText}: ${error[1].message}`;\n}\n\nfunction handleFormSubmission(event) {\n  event.preventDefault();\n  const city = document.querySelector('#location').value;\n  document.querySelector('#location').value = null;\n  getWeather(city);\n}\n\nwindow.addEventListener(\"load\", function() {\n  document.querySelector('form').addEventListener(\"submit\", handleFormSubmission);\n});\n"})}),"\n",(0,r.jsx)(n.p,{children:"Now let's break out the new code:"}),"\n",(0,r.jsx)(n.div,{className:"filename",children:"src/index.js"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'function getWeather(city) {\n  let promise = new Promise(function(resolve, reject) {\n    let request = new XMLHttpRequest();\n    const url = `http://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${process.env.API_KEY}`;\n    request.addEventListener("loadend", function() {\n      const response = JSON.parse(this.responseText);\n      if (this.status === 200) {\n        resolve([response, city]);\n      } else {\n        reject([this, response, city]);\n      }\n    });\n    request.open("GET", url, true);\n    request.send();\n  });\n\n  promise.then(function(response) {\n    printElements(response);\n  }, function(errorMessage) {\n    printError(errorMessage);\n  });\n}\n'})}),"\n",(0,r.jsxs)(n.p,{children:["In the ",(0,r.jsx)(n.code,{children:"getWeather"})," function, we now take our previous code that creates and sends an ",(0,r.jsx)(n.code,{children:"XMLHttpRequest"})," object and wrap it in a promise:"]}),"\n",(0,r.jsx)(n.div,{className:"filename",children:"src/index.js"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'let promise = new Promise(function(resolve, reject) {\n  let request = new XMLHttpRequest();\n  const url = `http://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${process.env.API_KEY}`;\n  request.addEventListener("loadend", function() {\n    const response = JSON.parse(this.responseText);\n    if (this.status === 200) {\n      resolve([response, city]);\n    } else {\n      reject([this, response, city]);\n    }\n  });\n  request.open("GET", url, true);\n  request.send();\n});\n'})}),"\n",(0,r.jsx)(n.p,{children:"As we learned in the last lesson, we need to determine when a promise is resolved or rejected:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// We use resolve() and reject() to determine whether a promise should be resolved or rejected.\n\nlet promise = new Promise(function(resolve, reject) {\n  resolve( // do this on resolution );\n  reject( // do this on rejection );\n});\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Our updated code already has a conditional so we just have to call ",(0,r.jsx)(n.code,{children:"resolve()"})," and ",(0,r.jsx)(n.code,{children:"reject()"})," inside of the conditional. You may notice a few additional changes, which we'll discuss further below."]}),"\n",(0,r.jsx)(n.div,{className:"filename",children:"src/index.js"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:'function getWeather() {\n  let promise = new Promise(function(resolve, reject) {\n    ...\n\n    request.addEventListener("loadend", function() {\n      const response = JSON.parse(this.responseText);\n      if (this.status === 200) {\n        resolve([response, city]);\n      } else {\n        reject([this, response, city]);\n      }\n    });\n  });\n\n  ...\n}\n\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Both ",(0,r.jsx)(n.code,{children:"resolve()"})," and ",(0,r.jsx)(n.code,{children:"reject()"})," can take only one argument, which means our previous code that uses two and three arguments with the ",(0,r.jsx)(n.code,{children:"printElements"})," and ",(0,r.jsx)(n.code,{children:"printError"})," functions no longer works."]}),"\n",(0,r.jsx)(n.p,{children:"Here's our previous code:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"if (this.status === 200) {\n  printElements(response, city);\n} else {\n  printError(this, response, city);\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"There are a lot of ways that you can resolve this issue. We've opted to add each original argument to an array, and pass the array in as the single argument:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"if (this.status === 200) {\n  resolve([response, city]);\n} else {\n  reject([this, response, city]);\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Take note that we don't have to pass in an array with 2 \u2013 3 pieces of data. It all depends on what we decide is valuable data to have when we resolve or reject the API call. For example, we could structure our resolve and reject function calls like this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"if (this.status === 200) {\n  resolve(response);\n} else {\n  reject(this);\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If we use the above code, when we resolve our API call (it came back successfully), we only pass in the APi response, and not the user-inputted data. Then, when we reject our API call (something went wrong), we only pass in the ",(0,r.jsx)(n.code,{children:"XMLHttpRequest"})," object (represented by ",(0,r.jsx)(n.code,{children:"this"}),"), so that we can print the ",(0,r.jsx)(n.code,{children:"status"})," and ",(0,r.jsx)(n.code,{children:"statusText"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["For the sake of trying something new, we'll continue with passing in arrays to both ",(0,r.jsx)(n.code,{children:"resolve()"})," and ",(0,r.jsx)(n.code,{children:"reject()"}),", in order to present more data to the user."]}),"\n",(0,r.jsx)(n.p,{children:"This means that we'll also have to update our two UI functions that handle printing the results to the webpage to have just one parameter, and treat that parameter as the array it now is. Here's the updated code:"}),"\n",(0,r.jsx)(n.div,{className:"filename",children:"src/index.js"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"// UI Logic\n\nfunction printElements(data) {\n  document.querySelector('#showResponse').innerText = `The humidity in ${data[1]} is ${data[0].main.humidity}%.\n  The temperature in Kelvins is ${data[0].main.temp} degrees.`;\n}\n\nfunction printError(error) {\n  document.querySelector('#showResponse').innerText = `There was an error accessing the weather data for ${error[2]}: ${error[0].status} ${error[0].statusText}: ${error[1].message}`;\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["But we haven't even called those functions yet! We need to look to our ",(0,r.jsx)(n.code,{children:"promise.then(...)"})," method call to find those function calls:"]}),"\n",(0,r.jsx)(n.div,{className:"filename",children:"src/index.js"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-js",children:"function getWeather() {\n  let promise = new Promise(function(resolve, reject) {\n    ...\n  });\n\n  promise.then(function(weatherDataArray) {\n    printElements(weatherDataArray);\n  }, function(errorArray) {\n    printError(errorArray);\n  });\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["In the last lesson, we discussed how ",(0,r.jsx)(n.code,{children:"Promise.prototype.then()"})," takes two arguments. Both are callback functions. The first argument is a function that should run if the promise is resolved. As we can see, this function calls ",(0,r.jsx)(n.code,{children:"printElements"}),", passing in the ",(0,r.jsx)(n.code,{children:"weatherDataArray"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["The second argument is a function that handles a rejected promise. In this case, we call ",(0,r.jsx)(n.code,{children:"printError"}),", passing in the ",(0,r.jsx)(n.code,{children:"errorArray"})," with error information."]}),"\n",(0,r.jsx)(n.p,{children:"As we can see, it didn't take much work at all to incorporate a promise in our code. They're really nice to work with \u2014 and they can make working with complex async code much easier."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:(0,r.jsxs)(n.a,{href:"https://github.com/epicodus-lessons/section-6-js-api-call-with-webpack/tree/2_xhr_api_call_with_promises",children:[(0,r.jsx)(n.i,{className:"glyphicon glyphicon-folder-open"}),"  Example GitHub Repo for API Project with Promises"]})})}),"\n",(0,r.jsxs)(n.p,{children:["The above link takes you to the branch called ",(0,r.jsx)(n.code,{children:"2_xhr_api_call_with_promises"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);
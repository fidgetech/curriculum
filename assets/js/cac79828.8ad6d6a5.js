"use strict";(self.webpackChunklhtp=self.webpackChunklhtp||[]).push([[51328],{28453:(e,t,s)=>{s.d(t,{R:()=>l,x:()=>a});var n=s(96540);const i={},r=n.createContext(i);function l(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),n.createElement(r.Provider,{value:t},e.children)}},38179:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"c-and-net/lessons-32-44-tdd-and-debugging/3-0-0-40-part-1-testing-static-class-members-and-collections","title":"\ud83d\udcd3 3.0.0.40 Part 1: Testing Static Class Members and Collections","description":"When we first created our C# Shape Tracker, we made sure to include a private static field called instances that is a list that stores all Triangle instances ever made. We also made a getter method and setter method that would allow us to access and manage instances: GetAll() and ClearAll(). In this lesson, we\'re going to test and create this same logic. In the process, we\'ll learn how to make assertions for collections using the static CollectionAssert.AreEqual() method from MSTest.","source":"@site/versioned_docs/version-v1_3/3_c-and-net/0_lessons-32-44-tdd-and-debugging/3-0-0-40-part-1-testing-static-class-members-and-collections.md","sourceDirName":"3_c-and-net/0_lessons-32-44-tdd-and-debugging","slug":"/c-and-net/lessons-32-44-tdd-and-debugging/3-0-0-40-part-1-testing-static-class-members-and-collections","permalink":"/v1.3/c-and-net/lessons-32-44-tdd-and-debugging/3-0-0-40-part-1-testing-static-class-members-and-collections","draft":false,"unlisted":false,"tags":[],"version":"v1_3","frontMatter":{"title":"\ud83d\udcd3 3.0.0.40 Part 1: Testing Static Class Members and Collections","day":"weekend","id":"3-0-0-40-part-1-testing-static-class-members-and-collections","hide_table_of_contents":true},"sidebar":"c-and-net","previous":{"title":"\ud83d\udcd3 3.0.0.39 Testing A Method with Multiple Behaviors","permalink":"/v1.3/c-and-net/lessons-32-44-tdd-and-debugging/3-0-0-39-testing-a-method-with-multiple-behaviors"},"next":{"title":"\ud83d\udcd3 3.0.0.41 Part 2: Adding a Teardown Method and Completing the Tests for Static Class Members","permalink":"/v1.3/c-and-net/lessons-32-44-tdd-and-debugging/3-0-0-41-part-2-adding-a-teardown-method-and-completing-the-tests-for-static-class-members"}}');var i=s(74848),r=s(28453);const l={title:"\ud83d\udcd3 3.0.0.40 Part 1: Testing Static Class Members and Collections",day:"weekend",id:"3-0-0-40-part-1-testing-static-class-members-and-collections",hide_table_of_contents:!0},a=void 0,o={},c=[{value:"Reference for the &quot;Red, Green, Refactor&quot; (RGR) Workflow",id:"reference-for-the-red-green-refactor-rgr-workflow",level:2},{value:"Testing the Private Static Field <code>_instances</code> through its Getter Method <code>GetAll()</code>",id:"testing-the-private-static-field-_instances-through-its-getter-method-getall",level:2},{value:"1.  Identify the simplest possible behavior the program must exhibit.",id:"1--identify-the-simplest-possible-behavior-the-program-must-exhibit",level:3},{value:"2.  Write a coded test for this behavior.",id:"2--write-a-coded-test-for-this-behavior",level:3},{value:"3. Before coding, confirm the test fails.",id:"3-before-coding-confirm-the-test-fails",level:3},{value:"4. Implement the behavior with the least amount of code possible.",id:"4-implement-the-behavior-with-the-least-amount-of-code-possible",level:3},{value:"5. Run the automated test to confirm it passes. If it doesn&#39;t, revisit step 4.",id:"5-run-the-automated-test-to-confirm-it-passes-if-it-doesnt-revisit-step-4",level:3}];function d(e){const t={code:"code",div:"div",font:"font",h2:"h2",h3:"h3",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(t.p,{children:["When we first created our C# Shape Tracker, we made sure to include a private ",(0,i.jsx)(t.strong,{children:"static"})," field called ",(0,i.jsx)(t.code,{children:"_instances"})," that is a list that stores all ",(0,i.jsx)(t.code,{children:"Triangle"})," instances ever made. We also made a getter method and setter method that would allow us to access and manage ",(0,i.jsx)(t.code,{children:"_instances"}),": ",(0,i.jsx)(t.code,{children:"GetAll()"})," and ",(0,i.jsx)(t.code,{children:"ClearAll()"}),". In this lesson, we're going to test and create this same logic. In the process, we'll learn how to make assertions for collections using the static ",(0,i.jsx)(t.code,{children:"CollectionAssert.AreEqual()"})," method from MSTest."]}),"\n",(0,i.jsx)(t.p,{children:"However, we'll quickly hit a roadblock that we'll need to resolve before we can complete our Shape Tracker logic!"}),"\n",(0,i.jsx)(t.h2,{id:"reference-for-the-red-green-refactor-rgr-workflow",children:'Reference for the "Red, Green, Refactor" (RGR) Workflow'}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.p,{children:'For reference, here\'s the "Red, Green, Refactor" (RGR) workflow we follow with TDD:'}),"\n",(0,i.jsxs)(t.ol,{children:["\n",(0,i.jsx)(t.li,{children:"Identify the simplest possible behavior the program must exhibit."}),"\n",(0,i.jsx)(t.li,{children:"Write a coded test for this behavior."}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.font,{color:"red",children:"Before coding, confirm the test fails."})}),"\n",(0,i.jsx)(t.li,{children:"Implement the behavior with the least amount of code possible."}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.font,{color:"green",children:"Run the automated test to confirm it passes. If it doesn't, revisit step 4."})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.font,{color:"green",children:"Confirm all previous tests still pass. If it doesn't, revisit step 4."})}),"\n",(0,i.jsx)(t.li,{children:(0,i.jsx)(t.font,{color:"blue",children:"Check if code can be refactored. If so, refactor and repeat step 6."})}),"\n",(0,i.jsx)(t.li,{children:"Commit your passing code."}),"\n",(0,i.jsx)(t.li,{children:"Repeat this process with the next simplest behavior."}),"\n"]}),"\n",(0,i.jsxs)(t.h2,{id:"testing-the-private-static-field-_instances-through-its-getter-method-getall",children:["Testing the Private Static Field ",(0,i.jsx)(t.code,{children:"_instances"})," through its Getter Method ",(0,i.jsx)(t.code,{children:"GetAll()"})]}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsx)(t.h3,{id:"1--identify-the-simplest-possible-behavior-the-program-must-exhibit",children:"1.  Identify the simplest possible behavior the program must exhibit."}),"\n",(0,i.jsxs)(t.p,{children:["We'll start by creating our private static ",(0,i.jsx)(t.code,{children:"_instances"})," field along with its getter method, ",(0,i.jsx)(t.code,{children:"GetAll()"}),"."]}),"\n",(0,i.jsx)(t.h3,{id:"2--write-a-coded-test-for-this-behavior",children:"2.  Write a coded test for this behavior."}),"\n",(0,i.jsxs)(t.p,{children:["Here's what the test will look like for the private static ",(0,i.jsx)(t.code,{children:"_instances"})," field and ",(0,i.jsx)(t.code,{children:"GetAll()"})," getter method. We'll explain the new code below the code snippet."]}),"\n",(0,i.jsx)(t.div,{className:"filename",children:"ShapeTracker.Solution/ShapeTracker.Tests/ModelTests/TriangleTests.cs"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:"using Microsoft.VisualStudio.TestTools.UnitTesting;\nusing ShapeTracker.Models;\nusing System.Collections.Generic; // new using directive!\n\nnamespace ShapeTracker.Tests\n{\n  [TestClass]\n  public class TriangleTests\n  {\n\n    ... // other tests omitted for brevity\n\n    [TestMethod]\n    public void GetAll_ReturnsAllTriangleInstances_List()\n    {\n      // Arrange\n      Triangle tri1 = new Triangle(2, 2, 9);\n      Triangle tri2 = new Triangle(21, 3, 9);\n      Triangle tri3 = new Triangle(1, 3, 9);\n      List<Triangle> expected = new List<Triangle> { tri1, tri2, tri3 };\n      // Act\n      List<Triangle> actualResult = Triangle.GetAll();\n      // Assert\n      CollectionAssert.AreEqual(expected, actualResult);\n    }\n\n  }\n}\n"})}),"\n",(0,i.jsx)(t.p,{children:"Notice a couple new things:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["First, we include a new using directive, because we're now working with the ",(0,i.jsx)(t.code,{children:"List<T>"})," type, which lives within the ",(0,i.jsx)(t.code,{children:"System.Collections.Generic"})," namespace."]}),"\n",(0,i.jsxs)(t.li,{children:["Second, we're using the static ",(0,i.jsx)(t.code,{children:"CollectionAssert.AreEqual()"})," method. This method works just in the same way as the ",(0,i.jsx)(t.code,{children:"Assert.AreEqual()"})," method in that it compares an expected value with the actual value, only it's meant to compare collections \u2014 arrays, lists, or dictionaries."]}),"\n"]}),"\n",(0,i.jsx)(t.p,{children:"We're ready to move onto the next step."}),"\n",(0,i.jsx)(t.h3,{id:"3-before-coding-confirm-the-test-fails",children:"3. Before coding, confirm the test fails."}),"\n",(0,i.jsxs)(t.p,{children:["If we run ",(0,i.jsx)(t.code,{children:"$ dotnet test"})," in the ",(0,i.jsx)(t.code,{children:"ShapeTracker.Tests"})," directory, we'll get a compiler error that confirms that our test fails and there are no false positives in our code:"]}),"\n",(0,i.jsxs)(t.pre,{children:[(0,i.jsx)(t.code,{style:{color:"red"},children:"\nC:\\Users\\staff\\Desktop\\ShapeTracker.Solution\\ShapeTracker.Tests\\ModelTests\\TriangleTests.cs(142,46): error CS0117: 'Triangle' does not contain a definition for 'GetAll' [C:\\Users\\staff\\Desktop\\ShapeTracker.Solution\\ShapeTracker.Tests\\ShapeTracker.Tests.csproj]\n"}),"\n"]}),"\n",(0,i.jsx)(t.h3,{id:"4-implement-the-behavior-with-the-least-amount-of-code-possible",children:"4. Implement the behavior with the least amount of code possible."}),"\n",(0,i.jsx)(t.p,{children:"To resolve the compiler error and pass out test, we'll need to do a few things:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["Create a private static field called ",(0,i.jsx)(t.code,{children:"_instances"})," set to a new, empty list of triangles."]}),"\n",(0,i.jsxs)(t.li,{children:["Add ",(0,i.jsx)(t.code,{children:"_instances.Add(this)"})," to our constructor to add each triangle object created to the list."]}),"\n",(0,i.jsxs)(t.li,{children:["Create a public getter method called ",(0,i.jsx)(t.code,{children:"GetAll()"})," that returns the ",(0,i.jsx)(t.code,{children:"_instances"})," field."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Here's our updated ",(0,i.jsx)(t.code,{children:"Triangle.cs"})," logic:"]}),"\n",(0,i.jsx)(t.div,{className:"filename",children:"ShapeTracker/Models/Triangle.cs"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'using System.Collections.Generic;\n\nnamespace ShapeTracker.Models\n{\n  public class Triangle\n  {\n    private int _side1;\n    public int Side1\n    {\n      get { return _side1; }\n      set { _side1 = value; }\n    }\n    public int Side2 { get; set; }\n    private int _side3;\n    private static List<Triangle> _instances = new List<Triangle> {};\n\n    public Triangle(int length1, int length2, int length3)\n    {\n      _side1 = length1;\n      Side2 = length2;\n      _side3 = length3;\n      _instances.Add(this);\n    }\n\n    public int GetSide3()\n    {\n      return _side3;\n    }\n\n    public void SetSide3(int newValue)\n    {\n      _side3 = newValue;\n    }\n\n    public string CheckType()\n    {\n      if ((Side1 > (Side2 + _side3)) || (Side2 > (Side1 + _side3)) || (_side3 > (Side1 + Side2)))\n      {\n        return "not a triangle";\n      } \n      else if ((Side1 != Side2) && ((Side1 != _side3)) && ((Side2 != _side3))) \n      {\n        return "scalene triangle";\n      }  \n      else if ((Side1 == Side2) && (Side1 == _side3)) \n      {\n        return "equilateral triangle";\n      } \n      else \n      {\n        return "isosceles triangle";\n      }\n    }\n\n    public static List<Triangle> GetAll()\n    {\n      return _instances;\n    }\n\n  }\n}\n'})}),"\n",(0,i.jsx)(t.h3,{id:"5-run-the-automated-test-to-confirm-it-passes-if-it-doesnt-revisit-step-4",children:"5. Run the automated test to confirm it passes. If it doesn't, revisit step 4."}),"\n",(0,i.jsx)(t.p,{children:"We're now ready to see if the code we implemented passes our new test."}),"\n",(0,i.jsxs)(t.p,{children:["When we run ",(0,i.jsx)(t.code,{children:"dotnet test"})," again, we our test fails:"]}),"\n",(0,i.jsxs)(t.pre,{children:[(0,i.jsx)(t.code,{style:{color:"red"},children:"\n  Failed GetAll_ReturnsAllTriangleInstances_List [87 ms]\n  Error Message:\n   CollectionAssert.AreEqual failed. (Different number of elements.)\n  Stack Trace:\n     at ShapeTracker.Tests.TriangleTests.GetAll_ReturnsAllTriangleInstances_List() in C:\\Users\\staff\\Desktop\\ShapeTracker.Solution\\ShapeTracker.Tests\\ModelTests\\TriangleTests.cs:line 144\n\n\nFailed!  - Failed:     1, Passed:    11, Skipped:     0, Total:    12, Duration: 304 ms - ShapeTracker.Tests.dll (net6.0)\n"}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["The failure message says ",(0,i.jsx)(t.code,{children:"Different number of elements"}),", but it doesn't give additional information."]}),"\n",(0,i.jsx)(t.p,{children:"Any ideas about what may be happening here?"}),"\n",(0,i.jsxs)(t.p,{children:["Well, the issue is not obvious... In fact, our code and test are written perfectly, and the issue is in our tests: because the tests will run in order, by the time it gets to our final ",(0,i.jsx)(t.code,{children:"GetAll"})," test, we've already many, many ",(0,i.jsx)(t.code,{children:"Triangle"})," objects to our static list \u2014 11 to be precise!"]}),"\n",(0,i.jsxs)(t.p,{children:["Remember that each time a new ",(0,i.jsx)(t.code,{children:"Triangle"})," object is created by the constructor, the entire ",(0,i.jsx)(t.code,{children:"Triangle"})," class has a new object added to its static ",(0,i.jsx)(t.code,{children:"List"})," of ",(0,i.jsx)(t.code,{children:"Triangle"})," objects. We can't reset the static list unless we manually clear the list (like with a static ",(0,i.jsx)(t.code,{children:"ClearAll()"})," method)! So, when our ",(0,i.jsx)(t.code,{children:"GetAll"})," test runs, it compares the ",(0,i.jsx)(t.code,{children:"expected"})," list of 3 triangles with a list of 14 ",(0,i.jsx)(t.code,{children:"Triangle"})," objects (11 from the previous tests and 3 from the ",(0,i.jsx)(t.code,{children:"GetAll"})," test)."]}),"\n",(0,i.jsxs)(t.p,{children:["Well, we can solve this issue with a ",(0,i.jsx)(t.strong,{children:"teardown"})," method that will clear out ",(0,i.jsx)(t.code,{children:"_instances"})," between each test. Let's learn how to do that in the next lesson!"]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);
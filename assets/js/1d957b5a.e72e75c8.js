"use strict";(self.webpackChunklhtp=self.webpackChunklhtp||[]).push([[74575],{28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>r});var a=n(96540);const i={},o=a.createContext(i);function s(e){const t=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(o.Provider,{value:t},e.children)}},32412:(e,t,n)=>{n.d(t,{A:()=>a});const a=n.p+"assets/files/aspnet-web-api-postman-post-request-with-body-9b8fd60d64d3654c7e3957298b870397.png"},55600:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"c-and-net/building-an-api/3-6-0-05-api-create-and-read","title":"\ud83d\udcd3 3.6.0.05 API: Create and Read","description":"Now that we have seeded animal data, we\'ll create our first custom API endpoints for CREATE and READ functionality. We\'ll add:","source":"@site/docs/3_c-and-net/6_building-an-api/3-6-0-05-api-create-and-read.md","sourceDirName":"3_c-and-net/6_building-an-api","slug":"/c-and-net/building-an-api/3-6-0-05-api-create-and-read","permalink":"/v1.2/c-and-net/building-an-api/3-6-0-05-api-create-and-read","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"\ud83d\udcd3 3.6.0.05 API: Create and Read","day":"weekend","id":"3-6-0-05-api-create-and-read","hide_table_of_contents":true},"sidebar":"c-and-net","previous":{"title":"\ud83d\udcd3 3.6.0.07 Seeding the Database","permalink":"/v1.2/c-and-net/building-an-api/3-6-0-07-seeding-the-database"},"next":{"title":"\ud83d\udcd3 3.6.0.06 API: Update and Delete","permalink":"/v1.2/c-and-net/building-an-api/3-6-0-06-api-update-and-delete"}}');var i=n(74848),o=n(28453);const s={title:"\ud83d\udcd3 3.6.0.05 API: Create and Read",day:"weekend",id:"3-6-0-05-api-create-and-read",hide_table_of_contents:!0},r=void 0,l={},c=[{value:"READ for Animals",id:"read-for-animals",level:2},{value:"Implicit Using Directives",id:"implicit-using-directives",level:3},{value:"Attribute Routing",id:"attribute-routing",level:3},{value:"We Never Return Views",id:"we-never-return-views",level:3},{value:"We Return HTTP Status Codes",id:"we-return-http-status-codes",level:3},{value:".NET Automatically Converts C# into JSON",id:"net-automatically-converts-c-into-json",level:3},{value:"It&#39;s a Best Practice to Use Async Controller Actions",id:"its-a-best-practice-to-use-async-controller-actions",level:3},{value:"We&#39;ll Use More HTTP Verb Templates, and These Contribute to Routing",id:"well-use-more-http-verb-templates-and-these-contribute-to-routing",level:3},{value:"Test the Endpoints",id:"test-the-endpoints",level:3},{value:"CREATE for Animals",id:"create-for-animals",level:2},{value:"Creating an <code>Animal</code>",id:"creating-an-animal",level:3}];function d(e){const t={a:"a",code:"code",div:"div",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(t.p,{children:"Now that we have seeded animal data, we'll create our first custom API endpoints for CREATE and READ functionality. We'll add:"}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["A GET endpoint at ",(0,i.jsx)(t.code,{children:"http://localhost:5000/api/animals"})," that will return all animal objects."]}),"\n",(0,i.jsxs)(t.li,{children:["A GET endpoint at ",(0,i.jsx)(t.code,{children:"http://localhost:5000/api/animals/{id}"})," that will return one animal object based on its ",(0,i.jsx)(t.code,{children:"AnimalId"})," property."]}),"\n",(0,i.jsxs)(t.li,{children:["A POST endpoint at ",(0,i.jsx)(t.code,{children:"http://localhost:5000/api/animals"})," that will add a new animal to our database and requires a request body with an object literal of an animal."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["In the process, we'll learn about general conventions when creating an API controller and important features of controller actions for controllers marked with the ",(0,i.jsx)(t.code,{children:"[ApiController]"}),"."]}),"\n",(0,i.jsx)(t.h2,{id:"read-for-animals",children:"READ for Animals"}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsxs)(t.p,{children:["We'll start by creating an ",(0,i.jsx)(t.code,{children:"AnimalsController.cs"})," with two new methods. One will return all the animals in our application while the other will return just one animal based on its ",(0,i.jsx)(t.code,{children:"AnimalId"})," property."]}),"\n",(0,i.jsx)(t.div,{className:"filename",children:"Controllers/AnimalsController.cs"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'using Microsoft.AspNetCore.Mvc;\nusing Microsoft.EntityFrameworkCore;\nusing CretaceousApi.Models;\n\nnamespace CretaceousApi.Controllers\n{\n  [Route("api/[controller]")]\n  [ApiController]\n  public class AnimalsController : ControllerBase\n  {\n    private readonly CretaceousApiContext _db;\n\n    public AnimalsController(CretaceousApiContext db)\n    {\n      _db = db;\n    }\n\n    // GET api/animals\n    [HttpGet]\n    public async Task<ActionResult<IEnumerable<Animal>>> Get()\n    {\n      return await _db.Animals.ToListAsync();\n    }\n\n    // GET: api/Animals/5\n    [HttpGet("{id}")]\n    public async Task<ActionResult<Animal>> GetAnimal(int id)\n    {\n      Animal animal = await _db.Animals.FindAsync(id);\n\n      if (animal == null)\n      {\n        return NotFound();\n      }\n\n      return animal;\n    }\n  }\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:"The controller code looks very similar to code we might use when building a web application, with a few key differences. Let's work through all of them now!"}),"\n",(0,i.jsx)(t.h3,{id:"implicit-using-directives",children:"Implicit Using Directives"}),"\n",(0,i.jsxs)(t.p,{children:["First take note that we're using the ",(0,i.jsx)(t.code,{children:"System.Collections.Generic"})," and ",(0,i.jsx)(t.code,{children:"System.Threading.Tasks"})," namespaces, but we don't need to explicitly list them in our ",(0,i.jsx)(t.code,{children:"AnimalsController"})," because we've enabled implicit using directives in our project file (",(0,i.jsx)(t.code,{children:".csproj"})," file)."]}),"\n",(0,i.jsx)(t.h3,{id:"attribute-routing",children:"Attribute Routing"}),"\n",(0,i.jsx)(t.p,{children:"Then, notice the attribute that we add to the top of the controller class:"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:'[Route("api/[controller]")]\n'})}),"\n",(0,i.jsxs)(t.p,{children:["With the above ",(0,i.jsx)(t.code,{children:"[Route]"})," attribute, we're specifying that the base request URL for the ",(0,i.jsx)(t.code,{children:"AnimalsController"})," is ",(0,i.jsx)(t.code,{children:"/api/animals"}),". So for example, when we make a GET request to ",(0,i.jsx)(t.code,{children:"http://localhost:5000/api/animals"}),", we'll access the ",(0,i.jsx)(t.code,{children:"Get()"})," action in our ",(0,i.jsx)(t.code,{children:"AnimalsController"}),", which will then handle returning all of the animals in our database."]}),"\n",(0,i.jsx)(t.h3,{id:"we-never-return-views",children:"We Never Return Views"}),"\n",(0,i.jsxs)(t.p,{children:["Another key difference is that we aren't returning a view. Our ",(0,i.jsx)(t.code,{children:"Get()"})," action returns an ",(0,i.jsx)(t.code,{children:"ActionResult"})," of type ",(0,i.jsx)(t.code,{children:"<IEnumerable<Animal>>"}),", and our ",(0,i.jsx)(t.code,{children:"GetAnimal()"})," action returns an ",(0,i.jsx)(t.code,{children:"ActionResult"})," of type ",(0,i.jsx)(t.code,{children:"<Animal>"}),". In our web applications, we didn't need to specify a type for our ",(0,i.jsx)(t.code,{children:"ActionResult"})," because we were always returning a view."]}),"\n",(0,i.jsx)(t.h3,{id:"we-return-http-status-codes",children:"We Return HTTP Status Codes"}),"\n",(0,i.jsxs)(t.p,{children:["Our GET endpoints not only return animals or an animal, they also return ",(0,i.jsx)(t.strong,{children:"HTTP status codes"}),"; when a successful GET request is returned from an API, there will also be a 200 OK HTTP status code returned. When we return a collection of animals or an animal object, the 200 OK status code is automatically added."]}),"\n",(0,i.jsxs)(t.p,{children:["When we want to generate another type of HTTP status code, we'll have to make use of ",(0,i.jsxs)(t.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.mvc.controllerbase?view=aspnetcore-6.0#methods",children:[(0,i.jsx)(t.code,{children:"ControllerBase"})," class methods"]}),". We can see an example of this in the ",(0,i.jsx)(t.code,{children:"GetAnimal()"})," action: if no animal matching the specified id is returned, then we return ",(0,i.jsx)(t.code,{children:"NotFound()"}),", which will send a 404 Not Found HTTP status code as our API's response."]}),"\n",(0,i.jsxs)(t.p,{children:["Take a moment to familiarize yourself with the ",(0,i.jsxs)(t.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.mvc.controllerbase?view=aspnetcore-6.0#methods",children:[(0,i.jsx)(t.code,{children:"ControllerBase"})," class methods"]}),". We won't use all of them in this Cretaceous Park API walkthrough, though you may find some of them useful in other APIs that you build."]}),"\n",(0,i.jsx)(t.h3,{id:"net-automatically-converts-c-into-json",children:".NET Automatically Converts C# into JSON"}),"\n",(0,i.jsxs)(t.p,{children:["You might be wondering... if our ",(0,i.jsx)(t.code,{children:"Get()"})," and ",(0,i.jsx)(t.code,{children:"GetAnimal()"})," endpoints returns C# objects, how do those get turned into JSON? Well, the answer is that .NET automatically converts C# into JSON for us."]}),"\n",(0,i.jsx)(t.h3,{id:"its-a-best-practice-to-use-async-controller-actions",children:"It's a Best Practice to Use Async Controller Actions"}),"\n",(0,i.jsxs)(t.p,{children:["You may also have noticed that all of our controller action methods are asynchronous. It's a best practice to make our controller action methods asynchronous so that they can scale to handle more requests. This doesn't make any individual request get processed faster; instead it frees up our application to handle all requests asynchronously, which means that our application can handle more requests. To learn more about this topic, check out ",(0,i.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/archive/msdn-magazine/2014/october/async-programming-introduction-to-async-await-on-asp-net",children:"this article on asynchronous code from the MSDN magazine"}),". It's an older article, but the concepts are still relevant today."]}),"\n",(0,i.jsx)(t.h3,{id:"well-use-more-http-verb-templates-and-these-contribute-to-routing",children:"We'll Use More HTTP Verb Templates, and These Contribute to Routing"}),"\n",(0,i.jsxs)(t.p,{children:["Another key difference is with the ",(0,i.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/aspnet/core/mvc/controllers/routing?view=aspnetcore-6.0#http-verb-templates",children:"HTTP verb templates"})," that we use, like ",(0,i.jsx)(t.code,{children:"[HttpGet]"})," and ",(0,i.jsx)(t.code,{children:"[HttpPost]"}),". While these aren't new, we'll now use more of them because we won't be making requests directly from an HTML5 form, which only supports GET and POST actions."]}),"\n",(0,i.jsxs)(t.p,{children:["Also, these HTTP verb templates are meant to specify what ",(0,i.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods",children:"HTTP action method"})," is needed to make the request. This means that not only do we need the right request URL, like ",(0,i.jsx)(t.code,{children:"http://localhost:5000/api/animals/"}),", we also need the right HTTP action method. For ",(0,i.jsx)(t.code,{children:"Get()"})," and ",(0,i.jsx)(t.code,{children:"GetAnimal()"}),", they both require a GET Http action."]}),"\n",(0,i.jsxs)(t.p,{children:["Notice the ",(0,i.jsx)(t.code,{children:"GetAnimal()"})," action's attribute: ",(0,i.jsx)(t.code,{children:'[HttpGet("{id}")]'}),". As we can see, the ",(0,i.jsx)(t.code,{children:"HttpGet()"})," method accepts an argument; when we include ",(0,i.jsx)(t.code,{children:'"{id}"'})," as the argument, this configures the endpoint to expect another value added to the end of it: ",(0,i.jsx)(t.code,{children:"/api/animals/{id}"}),", where ",(0,i.jsx)(t.code,{children:"{id}"})," is a variable for a value. With the ",(0,i.jsx)(t.code,{children:"GetAnimal()"})," action parameter ",(0,i.jsx)(t.code,{children:"int id"}),", we further specify that the value of ",(0,i.jsx)(t.code,{children:"{id}"})," should be an integer. This means we can now make a GET request with an animal's id in order to only get data for the animal that matches the specified id, just like this:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"http://localhost:5000/api/animals/1\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Note that the variable name ",(0,i.jsx)(t.code,{children:"id"})," in ",(0,i.jsx)(t.code,{children:'[HttpGet("{id}")]'})," and in ",(0,i.jsx)(t.code,{children:"GetAnimal(int id)"})," needs to match exactly. The value for the parameter ",(0,i.jsx)(t.code,{children:"id"})," comes directly from the request URL. If we do the above GET request, it will return the animal object that has an ",(0,i.jsx)(t.code,{children:"AnimalId"})," of 1."]}),"\n",(0,i.jsx)(t.h3,{id:"test-the-endpoints",children:"Test the Endpoints"}),"\n",(0,i.jsx)(t.p,{children:"At this point, we've covered all of the salient differences between an API controller and one for an MVC application. Go ahead and test out both of the routes in Postman or Swagger UI and confirm that they are functioning as expected."}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{children:"GET http://localhost:5000/api/animals\nGET http://localhost:5000/api/animals/2\n"})}),"\n",(0,i.jsx)(t.h2,{id:"create-for-animals",children:"CREATE for Animals"}),"\n",(0,i.jsx)(t.hr,{}),"\n",(0,i.jsxs)(t.p,{children:["Next, we'll add the ability to add animals to our database. Here's the new controller action method that we'll add to the ",(0,i.jsx)(t.code,{children:"AnimalsController"}),":"]}),"\n",(0,i.jsx)(t.div,{className:"filename",children:"Controllers/AnimalsController.cs"}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:"...\n    // POST api/animals\n    [HttpPost]\n    public async Task<ActionResult<Animal>> Post(Animal animal)\n    {\n      _db.Animals.Add(animal);\n      await _db.SaveChangesAsync();\n      return CreatedAtAction(nameof(GetAnimal), new { id = animal.AnimalId }, animal);\n    }\n...\n"})}),"\n",(0,i.jsxs)(t.p,{children:["Most of the features of our new ",(0,i.jsx)(t.code,{children:"Post()"})," method we covered when we explained our ",(0,i.jsx)(t.code,{children:"Get()"})," and ",(0,i.jsx)(t.code,{children:"GetAnimal()"})," action methods:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsx)(t.li,{children:"This is an asynchronous method so that our API is free to handle other requests while certain async code is being processed."}),"\n",(0,i.jsx)(t.li,{children:"We don't return a view."}),"\n",(0,i.jsxs)(t.li,{children:["We specify the HTTP action method with the Http verb template ",(0,i.jsx)(t.code,{children:"[HttpPost]"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(t.p,{children:["Other code is new. First notice that the ",(0,i.jsx)(t.code,{children:"Post()"})," method takes an ",(0,i.jsx)(t.code,{children:"Animal"})," parameter, which we call ",(0,i.jsx)(t.code,{children:"animal"}),". This ",(0,i.jsx)(t.code,{children:"animal"})," object comes from the ",(0,i.jsx)(t.strong,{children:"body"})," of the request. Since we've specified that our ",(0,i.jsx)(t.code,{children:"AnimalsController"})," is an ",(0,i.jsx)(t.code,{children:"[ApiController]"}),", our controller knows to infer that the value for the ",(0,i.jsx)(t.code,{children:"animal"})," parameter should come from the request body, and how to bind that data to an ",(0,i.jsx)(t.code,{children:"Animal"})," object. This is all thanks to built-in functionality for controllers marked with the ",(0,i.jsx)(t.code,{children:"[ApiController]"})," attribute."]}),"\n",(0,i.jsxs)(t.p,{children:["We could optionally explicitly state how controller action parameters should be bound. For example, we could use the ",(0,i.jsx)(t.code,{children:"[FromBody]"})," attribute to specify that the value of ",(0,i.jsx)(t.code,{children:"animal"})," is found in the request body:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:"    [HttpPost]\n    public async Task<ActionResult<Animal>> Post([FromBody] Animal animal)\n    {\n      ...\n    }\n"})}),"\n",(0,i.jsxs)(t.p,{children:["However doing so is optional with controllers marked with the ",(0,i.jsx)(t.code,{children:"[ApiController]"})," attribute. To learn more about model binding, visit ",(0,i.jsx)(t.a,{href:"https://learn.microsoft.com/en-us/aspnet/core/web-api/?view=aspnetcore-6.0#binding-source-parameter-inference",children:'the MS docs on "Binding Source Parameter Inference"'})," ."]}),"\n",(0,i.jsxs)(t.p,{children:["The next thing we should cover is the new method ",(0,i.jsx)(t.code,{children:"CreatedAtAction()"})," that our ",(0,i.jsx)(t.code,{children:"Post()"})," action uses to return a response:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-csharp",children:"return CreatedAtAction(nameof(GetAnimal), new { id = animal.AnimalId }, animal);\n"})}),"\n",(0,i.jsxs)(t.p,{children:[(0,i.jsx)(t.code,{children:"CreatedAtAction()"})," is another ",(0,i.jsxs)(t.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/microsoft.aspnetcore.mvc.controllerbase?view=aspnetcore-6.0#methods",children:[(0,i.jsx)(t.code,{children:"ControllerBase"})," class method"]})," that specifically handles returning an HTTP status code of 201 Created. More than just that, this method lets us specify the ",(0,i.jsx)(t.a,{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Location",children:"Location"})," of the newly created object. What this means is that our ",(0,i.jsx)(t.code,{children:"Post()"})," controller action will return the newly created ",(0,i.jsx)(t.code,{children:"Animal"}),' object to the user along with a "201 Created" status code, rather than the default 200 OK with no animal object.']}),"\n",(0,i.jsxs)(t.p,{children:["The ",(0,i.jsx)(t.code,{children:"CreatedAtAction()"})," method takes 3 arguments to specify the location of the new object:"]}),"\n",(0,i.jsxs)(t.ul,{children:["\n",(0,i.jsxs)(t.li,{children:["The name of the controller action, in this case the ",(0,i.jsx)(t.code,{children:"GetAnimal()"})," controller action specified via ",(0,i.jsx)(t.code,{children:"nameof(GetAnimal)"}),"."]}),"\n",(0,i.jsxs)(t.li,{children:["The route values required for the controller action in a new anonymous object, in this case an ",(0,i.jsx)(t.code,{children:"id"})," parameter for the ",(0,i.jsx)(t.code,{children:"GetAnimal()"})," controller action."]}),"\n",(0,i.jsx)(t.li,{children:"The resource that was created in this action."}),"\n"]}),"\n",(0,i.jsxs)(t.h3,{id:"creating-an-animal",children:["Creating an ",(0,i.jsx)(t.code,{children:"Animal"})]}),"\n",(0,i.jsxs)(t.p,{children:["Let's use our new ",(0,i.jsx)(t.code,{children:"Post()"})," action to add an animal to our database. We'll send a POST request to ",(0,i.jsx)(t.code,{children:"http://localhost:5000/api/animals"})," with a ",(0,i.jsx)(t.strong,{children:"body"}),". We can create an animal object by passing an ",(0,i.jsx)(t.strong,{children:"object literal"})," in the body of our API call:"]}),"\n",(0,i.jsx)(t.pre,{children:(0,i.jsx)(t.code,{className:"language-json",children:'{\n  "species": "Tyrannosaurus Rex",\n  "name": "Elizabeth",\n  "age": 8\n}\n'})}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsxs)(t.strong,{children:["Note that we should never include an ",(0,i.jsx)(t.code,{children:"animalId"})," property, as that value should always be set by our database."]})}),"\n",(0,i.jsxs)(t.p,{children:["Here's how adding a body to a POST request to ",(0,i.jsx)(t.code,{children:"http://localhost:5000/api/animals"})," looks using Postman:"]}),"\n",(0,i.jsx)(t.p,{children:(0,i.jsxs)(t.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:n(32412).A+"",children:["Adding a body to a POST request to ",(0,i.jsx)(t.code,{children:"http://localhost:5000/api/animals"})," using Postman."]})}),"\n",(0,i.jsxs)(t.p,{children:["When we make the POST request, we'll get a ",(0,i.jsx)(t.code,{children:"201 Created"})," status, which means the call was successful."]}),"\n",(0,i.jsxs)(t.p,{children:["Then, if we make a GET request to ",(0,i.jsx)(t.code,{children:"http://localhost:5000/api/animals"}),", we'll see our new ",(0,i.jsx)(t.code,{children:"Animal"})," will be returned in the response."]}),"\n",(0,i.jsx)(t.p,{children:"Up next, we'll add update and delete functionality, completing full CRUD for our API."})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,i.jsx)(t,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);
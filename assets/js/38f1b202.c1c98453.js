"use strict";(self.webpackChunklhtp=self.webpackChunklhtp||[]).push([[43691],{28453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>d});var t=a(96540);const s={},i=t.createContext(s);function o(e){const n=t.useContext(i);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),t.createElement(i.Provider,{value:n},e.children)}},86304:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>r,contentTitle:()=>d,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"c-and-net/building-an-api/5-6-0-04-adding-a-model-and-database","title":"\ud83d\udcd3 5.6.0.04 Adding a Model and Database","description":"Let\'s start work on our Cretaceous Park API. While the CLI scaffolded the basics for us, we\'ll still need to set up and configure our own database, controller, and models.","source":"@site/versioned_docs/version-WIP/c-and-net/6_building-an-api/3-6-0-04-adding-a-model-and-database.md","sourceDirName":"c-and-net/6_building-an-api","slug":"/c-and-net/building-an-api/5-6-0-04-adding-a-model-and-database","permalink":"/WIP/c-and-net/building-an-api/5-6-0-04-adding-a-model-and-database","draft":false,"unlisted":false,"tags":[],"version":"WIP","frontMatter":{"title":"\ud83d\udcd3 5.6.0.04 Adding a Model and Database","day":"weekend","id":"5-6-0-04-adding-a-model-and-database","hide_table_of_contents":true},"sidebar":"c-and-net","previous":{"title":"\ud83d\udcd3 5.6.0.03 Exploring the dotnet new Web API Template","permalink":"/WIP/c-and-net/building-an-api/5-6-0-03-exploring-the-dotnet-new-web-api-template"},"next":{"title":"\ud83d\udcd3 5.6.0.07 Seeding the Database","permalink":"/WIP/c-and-net/building-an-api/5-6-0-07-seeding-the-database"}}');var s=a(74848),i=a(28453);const o={title:"\ud83d\udcd3 5.6.0.04 Adding a Model and Database",day:"weekend",id:"5-6-0-04-adding-a-model-and-database",hide_table_of_contents:!0},d=void 0,r={},l=[{value:"Database Setup Review",id:"database-setup-review",level:2},{value:"Adding Database and Entity Models",id:"adding-database-and-entity-models",level:2},{value:"Updating <code>Program.cs</code> to Use MySQL and the <code>CretaceousApiContext</code>",id:"updating-programcs-to-use-mysql-and-the-cretaceousapicontext",level:2},{value:"Create the Initial Migration",id:"create-the-initial-migration",level:3}];function c(e){const n={code:"code",div:"div",h2:"h2",h3:"h3",hr:"hr",p:"p",pre:"pre",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Let's start work on our Cretaceous Park API. While the CLI scaffolded the basics for us, we'll still need to set up and configure our own database, controller, and models."}),"\n",(0,s.jsxs)(n.p,{children:["The first thing we'll do is delete the ",(0,s.jsx)(n.code,{children:"WeatherForecastController.cs"})," and ",(0,s.jsx)(n.code,{children:"WeatherForecast.cs"})," model. We'll be replacing the boilerplate controller and model with our own. If you want to use those files as reference, you can always save them, or regenerate them in a new scaffolded web API project."]}),"\n",(0,s.jsx)(n.h2,{id:"database-setup-review",children:"Database Setup Review"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["We'll add the necessary packages to our project for Entity Framework Core and migrations. Run the following commands in the ",(0,s.jsx)(n.code,{children:"CretaceousApi/"})," project directory:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ dotnet add package Microsoft.EntityFrameworkCore -v 6.0.0\n$ dotnet add package Pomelo.EntityFrameworkCore.MySql -v 6.0.0\n$ dotnet add package Microsoft.EntityFrameworkCore.Design -v 6.0.0\n"})}),"\n",(0,s.jsx)(n.h2,{id:"adding-database-and-entity-models",children:"Adding Database and Entity Models"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["Now, let's create our models. First, create a ",(0,s.jsx)(n.code,{children:"Models/"})," directory. Then create a new file called ",(0,s.jsx)(n.code,{children:"Models/Animal.cs"})," and add the following code:"]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"Models/Animal.cs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"namespace CretaceousApi.Models\n{\n  public class Animal\n  {\n    public int AnimalId { get; set; }\n    public string Name { get; set; }\n    public string Species { get; set; }\n    public int Age { get; set; }\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Our ",(0,s.jsx)(n.code,{children:"Animal"})," class will represent the creatures of the Cretaceous period. You are welcome to add other ",(0,s.jsx)(n.code,{children:"Animal"})," class properties, if you like!"]}),"\n",(0,s.jsxs)(n.p,{children:["Next, let's create a ",(0,s.jsx)(n.code,{children:"DbContext"})," class in a file called ",(0,s.jsx)(n.code,{children:"CretaceousApiContext.cs"}),":"]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"Models/CretaceousApiContext.cs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"using Microsoft.EntityFrameworkCore;\n\nnamespace CretaceousApi.Models\n{\n  public class CretaceousApiContext : DbContext\n  {\n    public DbSet<Animal> Animals { get; set; }\n\n    public CretaceousApiContext(DbContextOptions<CretaceousApiContext> options) : base(options)\n    {\n    }\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.h2,{id:"updating-programcs-to-use-mysql-and-the-cretaceousapicontext",children:["Updating ",(0,s.jsx)(n.code,{children:"Program.cs"})," to Use MySQL and the ",(0,s.jsx)(n.code,{children:"CretaceousApiContext"})]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["Next, we'll have to update ",(0,s.jsx)(n.code,{children:"Program.cs"})," to add MySQL as our database service."]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"CretaceousApi/Program.cs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'using CretaceousApi.Models;\nusing Microsoft.EntityFrameworkCore;\n\nvar builder = WebApplication.CreateBuilder(args);\n\nbuilder.Services.AddControllers();\n\nbuilder.Services.AddDbContext<CretaceousApiContext>(\n                  dbContextOptions => dbContextOptions\n                    .UseMySql(\n                      builder.Configuration["ConnectionStrings:DefaultConnection"], \n                      ServerVersion.AutoDetect(builder.Configuration["ConnectionStrings:DefaultConnection"]\n                    )\n                  )\n                );\n\nbuilder.Services.AddEndpointsApiExplorer();\nbuilder.Services.AddSwaggerGen();\n\nvar app = builder.Build();\n\nif (app.Environment.IsDevelopment())\n{\n    app.UseSwagger();\n    app.UseSwaggerUI();\n}\nelse \n{\n  app.UseHttpsRedirection();\n}\n\napp.UseAuthorization();\n\napp.MapControllers();\n\napp.Run();\n'})}),"\n",(0,s.jsxs)(n.p,{children:["We add our ",(0,s.jsx)(n.code,{children:"CretaceousApiContext"})," and MySQL database as a service in our application."]}),"\n",(0,s.jsxs)(n.p,{children:["Next, we need to update ",(0,s.jsx)(n.code,{children:"appsettings.json"})," with our database connection string:"]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"CretaceousApi/appsettings.json"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "Logging": {\n    "LogLevel": {\n      "Default": "Information",\n      "Microsoft.AspNetCore": "Warning"\n    }\n  },\n  "AllowedHosts": "*",\n  "ConnectionStrings": {\n    "DefaultConnection": "Server=localhost;Port=3306;database=cretaceous_api;uid=[YOUR-USERNAME-HERE];pwd=[YOUR-PASSWORD-HERE];"\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["In the connection string, make sure to update the values of ",(0,s.jsx)(n.code,{children:"uid"})," and ",(0,s.jsx)(n.code,{children:"pwd"})," with your own username and password."]}),"\n",(0,s.jsx)(n.h3,{id:"create-the-initial-migration",children:"Create the Initial Migration"}),"\n",(0,s.jsx)(n.p,{children:"Now we're ready to create our initial migration and update the database."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ dotnet ef migrations add Initial\n$ dotnet ef database update\n"})}),"\n",(0,s.jsx)(n.p,{children:"In the next lesson, we'll learn how to seed our database, and then we'll start writing custom API endpoints."})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}}}]);
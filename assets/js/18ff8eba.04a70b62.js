"use strict";(self.webpackChunklhtp=self.webpackChunklhtp||[]).push([[22678],{28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var a=t(96540);const s={},l=a.createContext(s);function i(e){const n=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(l.Provider,{value:n},e.children)}},93811:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"c-and-net/building-an-api/3-6-2-4-mvc-client-getall","title":"\ud83d\udcd3 3.6.2.4 MVC Client: GetAll()","description":"Over the weekend, you learned how to create an API. In the last course section you learned how to make a simple API call from a client (a console app and an MVC app). Over the next several lessons, we\'re going to put these concepts together and build an MVC client with full CRUD functionality that will interact with our API.","source":"@site/docs/3_c-and-net/6_building-an-api/3-6-2-04-mvc-client-getall.md","sourceDirName":"3_c-and-net/6_building-an-api","slug":"/c-and-net/building-an-api/3-6-2-4-mvc-client-getall","permalink":"/v1.2/c-and-net/building-an-api/3-6-2-4-mvc-client-getall","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"\ud83d\udcd3 3.6.2.4 MVC Client: GetAll()","day":"tuesday","id":"3-6-2-4-mvc-client-getall","hide_table_of_contents":true},"sidebar":"c-and-net","previous":{"title":"\u270f\ufe0f Building an API Part 2 (day 2)","permalink":"/v1.2/c-and-net/building-an-api/building-an-api-part-2-day-2"},"next":{"title":"\ud83d\udcd3 3.6.2.5 MVC Client: GetDetails()","permalink":"/v1.2/c-and-net/building-an-api/3-6-2-5-mvc-client-getdetails"}}');var s=t(74848),l=t(28453);const i={title:"\ud83d\udcd3 3.6.2.4 MVC Client: GetAll()",day:"tuesday",id:"3-6-2-4-mvc-client-getall",hide_table_of_contents:!0},o=void 0,r={},c=[{value:"Cretaceous Park Client Project Structure",id:"cretaceous-park-client-project-structure",level:2},{value:"Project Setup",id:"project-setup",level:3},{value:"Create the <code>Animal</code> and <code>ApiHelper</code> Models",id:"create-the-animal-and-apihelper-models",level:2},{value:"Adding a Controller and View",id:"adding-a-controller-and-view",level:2}];function d(e){const n={a:"a",code:"code",div:"div",em:"em",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.p,{children:"Over the weekend, you learned how to create an API. In the last course section you learned how to make a simple API call from a client (a console app and an MVC app). Over the next several lessons, we're going to put these concepts together and build an MVC client with full CRUD functionality that will interact with our API."}),"\n",(0,s.jsx)(n.h2,{id:"cretaceous-park-client-project-structure",children:"Cretaceous Park Client Project Structure"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["First, let's discuss the structure of this project. We ",(0,s.jsx)(n.em,{children:"could"})," put the API and the client (the application consuming the API data) in the same repository. However, the point of creating an APIs is that it is modular and can be accessed from ",(0,s.jsx)(n.em,{children:"any"})," frontend client that can make API calls \u2014 a JavaScript web app, a Ruby and Rails web app, a React Native phone app, or something else entirely! With that in mind, it makes more sense to keep our backend API and frontend MVC projects in separate repositories, running on different ports."]}),"\n",(0,s.jsx)(n.p,{children:"The process of building out our client will be very similar to previous lessons where we learned how to use RestSharp and Newtonsoft.Json, so these steps will not be laid out in as much detail as the initial lessons where we built an MVC application that made calls to the New York Times API. The few important differences will be highlighted."}),"\n",(0,s.jsxs)(n.p,{children:["We'll also scaffold an ASP.NET Core MVC app with the ",(0,s.jsx)(n.code,{children:"dotnet new"})," templating tool. Instead of deleting the boilerplate models and controllers like we did in our API, we'll leave them intact. Because of this, our application will be an odd mix of boilerplate and Cretaceous Park. However, it will give us the opportunity to explore the ",(0,s.jsx)(n.code,{children:"dotnet new"})," MVC template a bit more than we have in the past."]}),"\n",(0,s.jsx)(n.h3,{id:"project-setup",children:"Project Setup"}),"\n",(0,s.jsxs)(n.p,{children:["Outside of ",(0,s.jsx)(n.code,{children:"CretaceousApi.Solution"}),", create a new directory called ",(0,s.jsx)(n.code,{children:"CretaceousClient.Solution"}),", containing a ",(0,s.jsx)(n.code,{children:".gitignore"})," file and a README. Your ",(0,s.jsx)(n.code,{children:".gitignore"})," should contain ",(0,s.jsx)(n.code,{children:"obj"}),", ",(0,s.jsx)(n.code,{children:"bin"}),", ",(0,s.jsx)(n.code,{children:"appsettings.json"}),", and ",(0,s.jsx)(n.code,{children:"appsettings.*.json"})," if you will be adding sensitive data to it."]}),"\n",(0,s.jsxs)(n.p,{children:["Next, initialize Git and commit your ",(0,s.jsx)(n.code,{children:".gitignore"})," to your Git history."]}),"\n",(0,s.jsxs)(n.p,{children:["Next, run the following command within the ",(0,s.jsx)(n.code,{children:"CretaceousClient.Solution/"})," directory:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ dotnet new mvc -o CretaceousClient --framework net6.0\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Next, add the ",(0,s.jsx)(n.code,{children:"RestSharp"})," and ",(0,s.jsx)(n.code,{children:"NewtonSoft.Json"})," packages as shown in ",(0,s.jsx)(n.a,{href:"../../c-and-net/authentication-with-identity/3-5-2-1-making-an-api-call-with-restsharp",children:"Making an API Call with RestSharp"})," and ",(0,s.jsx)(n.a,{href:"../../c-and-net/authentication-with-identity/3-5-2-2-deserializing-api-responses-with-newtonsoft-json",children:"Deserializing API Responses with Newtonsoft.Json"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"$ dotnet add package RestSharp --version 108.0.3\n$ dotnet add package Newtonsoft.Json --version 13.0.2\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The next thing we'll want to do is disable a nullable context for the entire project. Comment out the line ",(0,s.jsx)(n.code,{children:"<Nullable>enable</Nullable>"})," within ",(0,s.jsx)(n.code,{children:"CreatceousClient.csproj"}),"."]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"CretaceousClient.csproj"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'<Project Sdk="Microsoft.NET.Sdk.Web">\n\n  <PropertyGroup>\n    <TargetFramework>net6.0</TargetFramework>\n    \x3c!-- <Nullable>enable</Nullable> --\x3e\n    <ImplicitUsings>enable</ImplicitUsings>\n  </PropertyGroup>\n\n</Project>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["We'll leave implicit using directives enabled in our ",(0,s.jsx)(n.code,{children:".csproj"})," file, however you are welcome to comment it out if you prefer."]}),"\n",(0,s.jsxs)(n.p,{children:["Because we're disabling a project-wide nullable context, we'll also have to update the boilerplate ",(0,s.jsx)(n.code,{children:"Models/ErrorViewModel.cs"})," to create a nullable context, because it uses a nullable type. Add the following to the top of the file:"]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"Models/ErrorViewModel.cs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"#nullable enable\n...\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Just as we can see in ",(0,s.jsx)(n.code,{children:"ErrorViewModel.cs"}),", we can still use nullable types in any file throughout our project, we just need to create ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/csharp/nullable-references#nullable-contexts",children:"a nullable context"})," using a directive like ",(0,s.jsx)(n.code,{children:"#nullable enable"}),". To review more information about nullable types, start with the LearnHowToProgram.com lesson on ",(0,s.jsx)(n.a,{href:"../../c-and-net/test-driven-development-with-c/3-1-2-6-nullable-types",children:"Nullable Types"}),"."]}),"\n",(0,s.jsxs)(n.h2,{id:"create-the-animal-and-apihelper-models",children:["Create the ",(0,s.jsx)(n.code,{children:"Animal"})," and ",(0,s.jsx)(n.code,{children:"ApiHelper"})," Models"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["Next, we'll create an ",(0,s.jsx)(n.code,{children:"Animal"})," class in the ",(0,s.jsx)(n.code,{children:"Models"})," folder, utilizing the properties we defined in ",(0,s.jsx)(n.code,{children:"CretaceousApi"})," along with a ",(0,s.jsx)(n.code,{children:"GetAnimals()"})," method. This requires very little new code and is very similar to code we built in the lessons on building an MVC app that queries the New York Times API."]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"Models/Animal.cs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"using System.Collections.Generic;\nusing System;\nusing Newtonsoft.Json;\nusing Newtonsoft.Json.Linq;\n\nnamespace CretaceousClient.Models\n{\n  public class Animal\n  {\n    public int AnimalId { get; set; }\n    public string Name { get; set; }\n    public string Species { get; set; }\n    public int Age { get; set; }\n\n    public static List<Animal> GetAnimals()\n    {\n      var apiCallTask = ApiHelper.GetAll();\n      var result = apiCallTask.Result;\n\n      JArray jsonResponse = JsonConvert.DeserializeObject<JArray>(result);\n      List<Animal> animalList = JsonConvert.DeserializeObject<List<Animal>>(jsonResponse.ToString());\n\n      return animalList;\n    }\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Let's take a closer look at the ",(0,s.jsx)(n.code,{children:"Animal.GetAnimals()"})," method. This method handles calling a method that queries our API for all ",(0,s.jsx)(n.code,{children:"Animal"})," objects and deserializing the API's response."]}),"\n",(0,s.jsxs)(n.p,{children:["Within this method we call on the ",(0,s.jsx)(n.code,{children:"ApiHelper.GetAll()"})," method; we have yet to create that class and method. However, one thing to note now is that we'll need a different ",(0,s.jsx)(n.code,{children:"Animal"})," class and ",(0,s.jsx)(n.code,{children:"ApiHelper"})," class method for each type of API call (GET, POST, PUT, DELETE) we want to make, because each returns a different format of data."]}),"\n",(0,s.jsxs)(n.p,{children:["Notice that we don't pass an API key as an argument to ",(0,s.jsx)(n.code,{children:"ApiHelper.GetAll();"}),". Your personal API will not require a key unless you add Token-Based Authentication through your further exploration."]}),"\n",(0,s.jsxs)(n.p,{children:["Next, take note that the ",(0,s.jsx)(n.code,{children:"jsonResponse"})," variable is of the type ",(0,s.jsx)(n.code,{children:"JArray"})," as opposed to ",(0,s.jsx)(n.code,{children:"JObject"}),". Since we're getting a ",(0,s.jsx)(n.em,{children:"collection"})," of results, we need to expect an array of objects. Remember that these types are from the ",(0,s.jsx)(n.code,{children:"Newtonsoft.Json"})," library."]}),"\n",(0,s.jsxs)(n.p,{children:["Next, let's actually create the ",(0,s.jsx)(n.code,{children:"ApiHelper"})," class. This class will contain the definition for our ",(0,s.jsx)(n.code,{children:"ApiHelper.GetAll()"})," method which actually handles making a call to our Cretaceous Park API."]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"Models/ApiHelper.cs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'using System.Threading.Tasks;\nusing RestSharp;\n\nnamespace CretaceousClient.Models\n{\n  public class ApiHelper\n  {\n    public static async Task<string> GetAll()\n    {\n      RestClient client = new RestClient("http://localhost:5000/");\n      RestRequest request = new RestRequest($"api/animals", Method.Get);\n      RestResponse response = await client.GetAsync(request);\n      return response.Content;\n    }\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Your API call should include the port that ",(0,s.jsx)(n.code,{children:"CretaceousApi"})," is set to listen to. For the purposes of this project, we assume it listens on port ",(0,s.jsx)(n.code,{children:"5000"})," using HTTP, as it does in the example repo. If you choose to deploy an API at some point, you'll need to update the URL to include the domain of the deployed site instead of ",(0,s.jsx)(n.code,{children:"localhost"}),". The endpoint itself for this particular call will be ",(0,s.jsx)(n.code,{children:"api/animals"}),". Also note that when you are done developing, you should revert back to using HTTPS with your API, and make a corresponding update to the domain in your MVC client requests."]}),"\n",(0,s.jsxs)(n.p,{children:["Notice that we're not using the ",(0,s.jsx)(n.code,{children:"ExecuteAsync()"})," RestSharp method as we did in the New York Times API call example project. Now we're using ",(0,s.jsx)(n.code,{children:"GetAsync()"}),". There's actually ",(0,s.jsx)(n.a,{href:"https://restsharp.dev/docs/usage/execute",children:"a variety of methods"})," we can use to make an API call with RestSharp. The advantage of using ",(0,s.jsx)(n.code,{children:"GetAsync()"})," is that it will throw an error if the server returns an error to us. This is vital if we want to create a robust frontend application. We'll use similar methods for other requests:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PostAsync()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"PutAsync()"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"DeleteAsync()"})}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Take note that we won't be including additional error handling or model validation as we put together a basic MVC frontend to communicate with our Cretaceous Park API. If you want to learn more about error handling with RestSharp, ",(0,s.jsx)(n.a,{href:"https://restsharp.dev/docs/advanced/error-handling",children:"visit the docs"}),"."]}),"\n",(0,s.jsx)(n.h2,{id:"adding-a-controller-and-view",children:"Adding a Controller and View"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"In order to view our list of animals in our MVC client, we still need to do the following:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Create a controller route"}),"\n",(0,s.jsx)(n.li,{children:"Create the corresponding views"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Let's start by creating the ",(0,s.jsx)(n.code,{children:"AnimalsController.cs"}),":"]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"Controllers/AnimalsController.cs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"using Microsoft.AspNetCore.Mvc;\nusing CretaceousClient.Models;\n\nnamespace CretaceousClient.Controllers;\n\npublic class AnimalsController : Controller\n{\n  public IActionResult Index()\n  {\n    List<Animal> animals = Animal.GetAnimals();\n    return View(animals);\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Notice that we're using a ",(0,s.jsx)(n.a,{href:"https://devblogs.microsoft.com/dotnet/welcome-to-csharp-10/#file-scoped-namespaces",children:"file-scoped namespace"})," for the ",(0,s.jsx)(n.code,{children:"CretaceousClient.Controllers"})," namespace."]}),"\n",(0,s.jsx)(n.p,{children:"Next, we'll create the view:"}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"Views/Animals/Index.cshtml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'@{\n    ViewData["Title"] = "Animals";\n}\n\n<h1>All Cretaceous Animals:</h1>\n\n<ol>\n@foreach (Animal animal in Model)\n{\n  <li><strong>@animal.Name</strong> the @animal.Species | <a href="/Animals/Details/@(animal.AnimalId)">View Details</a></li>\n}\n</ol>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["We've set a value for ",(0,s.jsx)(n.code,{children:'ViewData["Title"]'})," so that we set the title of our ",(0,s.jsx)(n.code,{children:"index.cshtml"})," webpage. The other boilerplate views specify the title for each webpage, so we will do the same in our views. If we don't, there will be no title. To learn more about ",(0,s.jsx)(n.code,{children:"ViewData"})," and ",(0,s.jsx)(n.code,{children:"ViewBag"})," to set a webpage title, ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/aspnet/core/mvc/views/overview?view=aspnetcore-6.0#using-viewdata-and-viewbag-simultaneously",children:"visit the docs"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Otherwise, notice that there's no layout specified. That's because the ",(0,s.jsx)(n.code,{children:"dotnet new"})," MVC template includes a ",(0,s.jsx)(n.code,{children:"_ViewStart.cshtml"})," file that specifies what all views should start with: the layout file!"]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"Views/_ViewStart.cshtml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'@{\n    Layout = "_Layout";\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["More specifically, the code in ",(0,s.jsx)(n.code,{children:"_ViewStart.cshtml"})," is run before the code in any view is run. To learn more, ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/aspnet/core/mvc/views/layout?view=aspnetcore-6.0#running-code-before-each-view",children:"check out the MS Docs"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Next, let's add a link to ",(0,s.jsx)(n.code,{children:"Animals/Index.cshtml"})," to our project's navbar. Add the following navbar item to the ",(0,s.jsx)(n.code,{children:"<nav>"})," element in ",(0,s.jsx)(n.code,{children:"_Layout.cshtml"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<li class="nav-item">\n    <a class="nav-link text-dark" asp-area="" asp-controller="Animals" asp-action="Index">See Animals</a>\n</li>\n'})}),"\n",(0,s.jsxs)(n.p,{children:["And here's what the ",(0,s.jsx)(n.code,{children:"<nav>"})," element should now look like:"]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"Views/Shared/_Layout.cshtml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'...\n\n<nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white border-bottom box-shadow mb-3">\n    <div class="container-fluid">\n        <a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Index">CretaceousClient</a>\n        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls="navbarSupportedContent"\n                aria-expanded="false" aria-label="Toggle navigation">\n            <span class="navbar-toggler-icon"></span>\n        </button>\n        <div class="navbar-collapse collapse d-sm-inline-flex justify-content-between">\n            <ul class="navbar-nav flex-grow-1">\n                <li class="nav-item">\n                    <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Index">Home</a>\n                </li>\n                <li class="nav-item">\n                    <a class="nav-link text-dark" asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a>\n                </li>\n                <li class="nav-item">\n                    <a class="nav-link text-dark" asp-area="" asp-controller="Animals" asp-action="Index">See Animals</a>\n                </li>\n            </ul>\n        </div>\n    </div>\n</nav>\n\n...\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Curious where the navbar and styling comes from? Well ",(0,s.jsx)(n.strong,{children:"Bootstrap"}),", of course!"]}),"\n",(0,s.jsxs)(n.p,{children:["Also note that the boilerplate ",(0,s.jsx)(n.code,{children:".cshtml"})," files makes use of ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/aspnet/core/mvc/views/tag-helpers/intro?view=aspnetcore-6.0",children:"tag helpers"})," like ",(0,s.jsx)(n.code,{children:"asp-area"})," and ",(0,s.jsx)(n.code,{children:"asp-controller"}),", which we haven't worked with a lot. To learn more about tag helpers, ",(0,s.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/aspnet/core/mvc/views/tag-helpers/intro?view=aspnetcore-6.0",children:"visit the MS docs"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Finally, let's update the welcome message in ",(0,s.jsx)(n.code,{children:"Home/Index.cshtml"})," so it is about our Cretaceous Park website:"]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"Views/Home/Index.cshtml"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'@{\n    ViewData["Title"] = "Home Page";\n}\n\n<div class="text-center">\n  <h1 class="display-4">Welcome to the Cretaceous Park!</h1>\n  <p>Get to know a few of <a href="/animals">our animals</a> from the Cretaceous period!</p>\n</div>\n'})}),"\n",(0,s.jsx)(n.p,{children:"And that's it! If you want to test out this functionality so far, make sure that you have both the API and client servers running."}),"\n",(0,s.jsx)(n.p,{children:"In the next lesson in this series, we'll discuss making an API call for a single animal's details."})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);
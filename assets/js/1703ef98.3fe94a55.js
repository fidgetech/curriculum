"use strict";(self.webpackChunklhtp=self.webpackChunklhtp||[]).push([[5502],{6377:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"c-and-net/database-basics/5-3-0-05-connecting-a-database-to-an-asp-net-core-app-with-mysqlconnector","title":"\ud83d\udcd3 5.3.0.05 Connecting a Database to an ASP.NET Core App with MySqlConnector","description":"In the last lesson, we created a database for our To Do List using MySQL Workbench. In this lesson, we\'ll connect the database to our application using a tool called MySqlConnector. Once connected, we\'ll be able to interact with our database and its tables as C# objects in our application.","source":"@site/versioned_docs/version-WIP/c-and-net/3_database-basics/3-3-0-05-connecting-a-database-to-an-asp-net-core-app-with-mysqlconnector.md","sourceDirName":"c-and-net/3_database-basics","slug":"/c-and-net/database-basics/5-3-0-05-connecting-a-database-to-an-asp-net-core-app-with-mysqlconnector","permalink":"/WIP/c-and-net/database-basics/5-3-0-05-connecting-a-database-to-an-asp-net-core-app-with-mysqlconnector","draft":false,"unlisted":false,"tags":[],"version":"WIP","frontMatter":{"title":"\ud83d\udcd3 5.3.0.05 Connecting a Database to an ASP.NET Core App with MySqlConnector","day":"weekend","id":"5-3-0-05-connecting-a-database-to-an-asp-net-core-app-with-mysqlconnector","hide_table_of_contents":true},"sidebar":"c-and-net","previous":{"title":"\ud83d\udcd3 5.3.0.04 Introduction to MySQL Workbench: Creating a Database","permalink":"/WIP/c-and-net/database-basics/5-3-0-04-introduction-to-mysql-workbench-creating-a-database"},"next":{"title":"\ud83d\udcd3 5.3.0.06 Retrieving Objects From the Database","permalink":"/WIP/c-and-net/database-basics/5-3-0-06-retrieving-objects-from-the-database"}}');var s=t(74848),a=t(28453);const i={title:"\ud83d\udcd3 5.3.0.05 Connecting a Database to an ASP.NET Core App with MySqlConnector",day:"weekend",id:"5-3-0-05-connecting-a-database-to-an-asp-net-core-app-with-mysqlconnector",hide_table_of_contents:!0},r=void 0,c={},l=[{value:"To Do List Database Refactor Plan",id:"to-do-list-database-refactor-plan",level:2},{value:"Project Structure &amp; Configuration",id:"project-structure--configuration",level:2},{value:"MySqlConnector Installation &amp; Configuration",id:"mysqlconnector-installation--configuration",level:2},{value:"Installing the MySqlConnector Package",id:"installing-the-mysqlconnector-package",level:3},{value:"Creating a Database Connection String",id:"creating-a-database-connection-string",level:3},{value:"Protecting the Database Connection String with <code>appsettings.json</code>",id:"protecting-the-database-connection-string-with-appsettingsjson",level:3},{value:"Accessing <code>appsettings.json</code> through <code>builder.Configuration</code> in <code>Program.cs</code>",id:"accessing-appsettingsjson-through-builderconfiguration-in-programcs",level:3},{value:"Making the Connection String Available throughout the App",id:"making-the-connection-string-available-throughout-the-app",level:3}];function d(e){const n={a:"a",code:"code",div:"div",h2:"h2",h3:"h3",hr:"hr",i:"i",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["In the last lesson, we created a database for our To Do List using MySQL Workbench. In this lesson, we'll connect the database to our application using a tool called ",(0,s.jsx)(n.strong,{children:"MySqlConnector"}),". Once connected, we'll be able to interact with our database and its tables as C# objects in our application."]}),"\n",(0,s.jsx)(n.p,{children:"First, let's think about how we'll refactor our To Do List app to use a database."}),"\n",(0,s.jsx)(n.h2,{id:"to-do-list-database-refactor-plan",children:"To Do List Database Refactor Plan"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:"The rest of the weekend homework will focus on building methods to access and update our database from scratch. This process is labor-intensive and involves a lot of tedious boilerplate code. Later in this section, we'll learn to use a framework called Entity Framework Core that manages our database connection and provides easy-to-use methods to access and update our database. The goal of building database methods from scratch now is to to get an understanding of what is really going on under the hood before we start using Entity Framework Core."}),"\n",(0,s.jsxs)(n.p,{children:["You are welcome to code along with these lessons, or simply to read through them. At the end of this walkthrough, we'll provide an example repo with the finished project. If you'd like to get a sense of ",(0,s.jsx)(n.strong,{children:"the finished project"})," in advance, go ahead and take a look at the following repo:"]}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:(0,s.jsxs)(n.a,{href:"https://github.com/epicodus-lessons/section-3-to-do-list-with-mysqlconnector-csharp-net6",children:[(0,s.jsx)(n.i,{className:"glyphicon glyphicon-folder-open"}),"  Example GitHub Repo for To Do List with MySqlConnector"]})})}),"\n",(0,s.jsx)(n.h2,{id:"project-structure--configuration",children:"Project Structure & Configuration"}),"\n",(0,s.jsx)(n.p,{children:"Let's start refactoring our To Do List app to use a MySQL database. After following along with the last section's lessons, our To Do List's file and folder structure should look like this:"}),"\n",(0,s.jsx)(n.pre,{children:"ToDoList.Solution\n\u251c\u2500\u2500 ToDoList\n\u2502\xa0\xa0 \u251c\u2500\u2500 Controllers\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 CategoriesController.cs\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 HomeController.cs\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 ItemsController.cs\n\u2502\xa0\xa0 \u251c\u2500\u2500 Models\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u251c\u2500\u2500 Category.cs\n\u2502\xa0\xa0 \u2502\xa0\xa0 \u2514\u2500\u2500 Item.cs\n\u2502\xa0\xa0 \u251c\u2500\u2500 Program.cs\n\u2502   \u251c\u2500\u2500 Properties\n\u2502   \u2502   \u2514\u2500\u2500 launchSettings.json\n\u2502\xa0\xa0 \u251c\u2500\u2500 ToDoList.csproj\n\u2502\xa0\xa0 \u2514\u2500\u2500 Views\n\u2502\xa0\xa0     \u251c\u2500\u2500 Categories\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 Index.cshtml\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u251c\u2500\u2500 New.cshtml\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u2514\u2500\u2500 Show.cshtml\n\u2502\xa0\xa0     \u251c\u2500\u2500 Home\n\u2502\xa0\xa0     \u2502\xa0\xa0 \u2514\u2500\u2500 Index.cshtml\n\u2502\xa0\xa0     \u2514\u2500\u2500 Items\n\u2502\xa0\xa0         \u251c\u2500\u2500 New.cshtml\n\u2502\xa0\xa0         \u2514\u2500\u2500 Show.cshtml\n\u2514\u2500\u2500 ToDoList.Tests\n    \u251c\u2500\u2500 ModelTests\n    \u2502\xa0\xa0 \u251c\u2500\u2500 CategoryTests.cs\n    \u2502\xa0\xa0 \u2514\u2500\u2500 ItemTests.cs\n    \u2514\u2500\u2500 ToDoList.Tests.csproj\n"}),"\n",(0,s.jsxs)(n.p,{children:["Your project directory may be slightly different if you added a ",(0,s.jsx)(n.code,{children:"Shared"})," directory with a ",(0,s.jsx)(n.code,{children:"_Layout.cshtml"})," file or if you included static assets in a ",(0,s.jsx)(n.code,{children:"wwwroot"})," directory (with related subdirectories)."]}),"\n",(0,s.jsx)(n.h2,{id:"mysqlconnector-installation--configuration",children:"MySqlConnector Installation & Configuration"}),"\n",(0,s.jsx)(n.hr,{}),"\n",(0,s.jsxs)(n.p,{children:["We'll begin by walking through how to set up a MySQL database connection in a project using MySqlConnector. Let's update our ",(0,s.jsx)(n.code,{children:".csproj"})," file to include MySqlConnector."]}),"\n",(0,s.jsx)(n.h3,{id:"installing-the-mysqlconnector-package",children:"Installing the MySqlConnector Package"}),"\n",(0,s.jsxs)(n.p,{children:["We can use the following command in the production directory of our project (",(0,s.jsx)(n.code,{children:"ToDoList.Solution/ToDoList"}),") to add this package:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ dotnet add package MySqlConnector -v 2.2.0\n"})}),"\n",(0,s.jsx)(n.p,{children:"This command should also automatically restore the packages in our application, but if you encounter any errors, run the following command to manually restore packages:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"$ dotnet restore\n"})}),"\n",(0,s.jsx)(n.h3,{id:"creating-a-database-connection-string",children:"Creating a Database Connection String"}),"\n",(0,s.jsxs)(n.p,{children:["When we connect to our database, we must manually open a connection by creating a new instance of the ",(0,s.jsx)(n.code,{children:"MySqlConnection"})," class from the MySqlConnector package. We'll learn exactly how to do this in upcoming lessons. What's important to know right now is that the ",(0,s.jsx)(n.code,{children:"MySqlConnection"})," constructor expects a database ",(0,s.jsx)(n.strong,{children:"connection string"})," that contains the access details of our database: its name, the database user and password, and the database server and port. For our To Do List app, this is what our connection string will look like:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'"server=localhost;port=3306;uid=root;pwd=epicodus;database=to_do_list_with_mysqlconnector;"\n'})}),"\n",(0,s.jsx)(n.p,{children:"The connection string includes five distinct parts:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"server"})})," identifies our database's server. We list ",(0,s.jsx)(n.code,{children:"localhost"})," because our application is running on a server local to our machine, not online."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"uid"})})," identifies our database's user. In the LearnHowToProgram.com example lessons, we'll always assume the user is 'root'."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"pwd"})})," provides the password for the given user. You should input your own password that you set up as the value to this field. In the LearnHowToProgram.com example lessons, we'll always assume the password is 'epicodus'."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"port"})})," identifies the port MySQL is running on. The default port number for a MySQL server is 3306."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:(0,s.jsx)(n.code,{children:"database"})})," is the database name. In our case, this is the ",(0,s.jsx)(n.code,{children:"to_do_list_with_mysqlconnector"})," database we created a few lessons ago."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.h3,{id:"protecting-the-database-connection-string-with-appsettingsjson",children:["Protecting the Database Connection String with ",(0,s.jsx)(n.code,{children:"appsettings.json"})]}),"\n",(0,s.jsxs)(n.p,{children:["Notably, the connection string contains sensitive data (password and username) that we don't want exposed on the internet. So what can we do to hide this information, but still use it in our project? ASP.NET Core provides built-in support for managing application configurations through a file called ",(0,s.jsx)(n.code,{children:"appsettings.json"}),". As the name suggests this file is written in JSON and it contains application settings, like database connection strings."]}),"\n",(0,s.jsxs)(n.p,{children:["In order to protect the data in ",(0,s.jsx)(n.code,{children:"appsettings.json"}),", we must add it to our ",(0,s.jsx)(n.code,{children:".gitignore"})," so that it never gets saved to our remote repository. Let's do that first, before we create ",(0,s.jsx)(n.code,{children:"appsettings.json"}),"."]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:".gitignore"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"obj\nbin\nappsettings.json\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Make sure to commit the changes you made to your ",(0,s.jsx)(n.code,{children:".gitignore"})," before moving on."]}),"\n",(0,s.jsxs)(n.p,{children:["Next, let's create ",(0,s.jsx)(n.code,{children:"appsettings.json"}),". Within the production directory of our project (",(0,s.jsx)(n.code,{children:"ToDoList.Solution/ToDoList"}),"), create ",(0,s.jsx)(n.code,{children:"appsettings.json"})," and add the following code to it:"]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"ToDoList.Solution/ToDoList/appsettings.json"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n    "ConnectionStrings": {\n        "DefaultConnection": "Server=localhost;Port=3306;database=to_do_list_with_mysqlconnector;uid=[YOUR-USERNAME-HERE];pwd=[YOUR-PASSWORD-HERE];"\n    }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Make sure to update the connection string with the values that you set for your username and password."})," As noted earlier, we'll always assume the user is 'root' and the password is ",(0,s.jsx)(n.code,{children:"epicodus"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Also note that since our ",(0,s.jsx)(n.code,{children:"appsettings.json"})," has been put in our ",(0,s.jsx)(n.code,{children:".gitignore"}),", users will not have access to it when cloning our project. ",(0,s.jsx)(n.strong,{children:"This means that you will need to add specific instructions in your README that tells the user where to create the file, and what code to include in it."}),"  We recommend using the above formatting and directing users to replace ",(0,s.jsx)(n.code,{children:"[YOUR-USERNAME-HERE]"})," and ",(0,s.jsx)(n.code,{children:"[YOUR-PASSWORD-HERE]"})," with the user's own user and password values."]}),"\n",(0,s.jsxs)(n.h3,{id:"accessing-appsettingsjson-through-builderconfiguration-in-programcs",children:["Accessing ",(0,s.jsx)(n.code,{children:"appsettings.json"})," through ",(0,s.jsx)(n.code,{children:"builder.Configuration"})," in ",(0,s.jsx)(n.code,{children:"Program.cs"})]}),"\n",(0,s.jsxs)(n.p,{children:["ASP.NET Core automatically loads ",(0,s.jsx)(n.code,{children:"appsettings.json"})," as our application host's official configuration file. This happens implicitly when we create our ",(0,s.jsx)(n.code,{children:"WebApplicationBuilder"})," in ",(0,s.jsx)(n.code,{children:"Program.cs"}),". Remember the following line of code?"]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"ToDoList.Solution/ToDoList/Program.cs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"using Microsoft.AspNetCore.Builder;\nusing Microsoft.Extensions.DependencyInjection;\nusing ToDoList.Models;\n\nnamespace ToDoList\n{\n  class Program\n  {\n    static void Main(string[] args)\n    {\n      WebApplicationBuilder builder = WebApplication.CreateBuilder(args);\n\n      ...\n    }\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Well, when we create the ",(0,s.jsx)(n.code,{children:"builder"})," instance, our configurations in ",(0,s.jsx)(n.code,{children:"appsettings.json"})," automatically get loaded and added to our web app host as a property of the ",(0,s.jsx)(n.code,{children:"builder"})," instance: ",(0,s.jsx)(n.code,{children:"builder.Configuration"}),". Here's how we'll access our database connection string in ",(0,s.jsx)(n.code,{children:"Program.cs"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cs",children:'builder.Configuration["ConnectionStrings:DefaultConnection"];\n'})}),"\n",(0,s.jsxs)(n.p,{children:["The big implication here is that we can't access the ",(0,s.jsx)(n.code,{children:"appsettings.json"})," data from just anywhere in our app. If we want to access data in ",(0,s.jsx)(n.code,{children:"appsettings.json"}),", we need to do it through ",(0,s.jsx)(n.code,{children:"builder.Configuration"})," in ",(0,s.jsx)(n.code,{children:"Program.cs"})," when we create our web app host. So, our next two steps are to create a class with a property that holds the database connection string that we can use throughout our application, and then update ",(0,s.jsx)(n.code,{children:"Program.cs"})," to set the value of that property."]}),"\n",(0,s.jsx)(n.h3,{id:"making-the-connection-string-available-throughout-the-app",children:"Making the Connection String Available throughout the App"}),"\n",(0,s.jsxs)(n.p,{children:["Let's first create a class to store the database connection string. Create a new file called ",(0,s.jsx)(n.code,{children:"DatabaseConfig.cs"})," and add it to the ",(0,s.jsx)(n.code,{children:"ToDoList/Models"})," directory:"]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"ToDoList.Solution/ToDoList/Models/DatabaseConfig.cs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:"namespace ToDoList.Models\n{\n  public static class DBConfiguration\n  {\n    public static string ConnectionString { get; set; }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"Note that we can name the file name, class name, and property whatever we like so long as we follow the general convention of descriptive naming."}),"\n",(0,s.jsxs)(n.p,{children:["Also notice that the class and property are both ",(0,s.jsx)(n.code,{children:"static"}),", meaning that the class can't have an instance, and the property also cannot be called on an instance. When we want to get or set ",(0,s.jsx)(n.code,{children:"ConnectionString"}),", we'll do so by accessing ",(0,s.jsx)(n.code,{children:"DBConfiguration.ConnectionString"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Next let's update ",(0,s.jsx)(n.code,{children:"Program.cs"})," to set the value of the ",(0,s.jsx)(n.code,{children:"ConnectionString"})," property to the database connection string within ",(0,s.jsx)(n.code,{children:"appsettings.json"}),". We'll do this by adding one new line of code to ",(0,s.jsx)(n.code,{children:"Program.cs"}),":"]}),"\n",(0,s.jsx)(n.div,{className:"filename",children:"ToDoList.Solution/ToDoList/Program.cs"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-csharp",children:'using Microsoft.AspNetCore.Builder;\nusing Microsoft.Extensions.DependencyInjection;\nusing ToDoList.Models;\n\nnamespace ToDoList\n{\n  class Program\n  {\n    static void Main(string[] args)\n    {\n      WebApplicationBuilder builder = WebApplication.CreateBuilder(args);\n\n      builder.Services.AddControllersWithViews();\n\n      // new line!\n      DBConfiguration.ConnectionString = builder.Configuration["ConnectionStrings:DefaultConnection"];\n\n      WebApplication app = builder.Build();\n\n      ...\n\n      app.Run();\n    }\n  }\n}\n'})}),"\n",(0,s.jsxs)(n.p,{children:["We can now use our database connection string via ",(0,s.jsx)(n.code,{children:"DBConfiguration.ConnectionString"})," anywhere in our application. What's more, we've protected our database connection string by adding it to ",(0,s.jsx)(n.code,{children:"appsettings.json"})," which we've told Git to ignore. We haven't yet learned how to open a database connection with the connection string, but that's exactly what we'll do in the next lesson."]}),"\n",(0,s.jsxs)(n.p,{children:["Going forward, don't forget to include setup instructions in your README for an ",(0,s.jsx)(n.code,{children:"appsettings.json"})," with a database connection string."]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>r});var o=t(96540);const s={},a=o.createContext(s);function i(e){const n=o.useContext(a);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),o.createElement(a.Provider,{value:n},e.children)}}}]);
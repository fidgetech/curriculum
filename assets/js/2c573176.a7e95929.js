"use strict";(self.webpackChunklhtp=self.webpackChunklhtp||[]).push([[42745],{28453:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>d});var a=t(96540);const i={},o=a.createContext(i);function s(e){const n=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),a.createElement(o.Provider,{value:n},e.children)}},44682:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>r});const a=JSON.parse('{"id":"c-and-net/many-to-many-relationships/3-4-0-6-many-to-many-create-functionality","title":"\ud83d\udcd3 3.4.0.6 Many-to-Many Create Functionality","description":"In the last lesson, we added read functionality for our new Tag class. In this lesson, we\'ll add create functionality in order to make new tags. We\'ll also add routes and views to make it possible to create a many-to-many association between tags and items from both the TagsController and ItemsController.","source":"@site/versioned_docs/version-v1_3/3_c-and-net/4_many-to-many-relationships/3-4-0-06-many-to-many-create-functionality.md","sourceDirName":"3_c-and-net/4_many-to-many-relationships","slug":"/c-and-net/many-to-many-relationships/3-4-0-6-many-to-many-create-functionality","permalink":"/v1.3/c-and-net/many-to-many-relationships/3-4-0-6-many-to-many-create-functionality","draft":false,"unlisted":false,"tags":[],"version":"v1_3","frontMatter":{"title":"\ud83d\udcd3 3.4.0.6 Many-to-Many Create Functionality","day":"weekend","id":"3-4-0-6-many-to-many-create-functionality","hide_table_of_contents":true},"sidebar":"c-and-net","previous":{"title":"\ud83d\udcd3 3.4.0.5 Many-to-Many Read Functionality","permalink":"/v1.3/c-and-net/many-to-many-relationships/3-4-0-5-many-to-many-read-functionality"},"next":{"title":"\ud83d\udcd3 3.4.0.7 Many-to-Many Update Functionality","permalink":"/v1.3/c-and-net/many-to-many-relationships/3-4-0-7-many-to-many-update-functionality"}}');var i=t(74848),o=t(28453);const s={title:"\ud83d\udcd3 3.4.0.6 Many-to-Many Create Functionality",day:"weekend",id:"3-4-0-6-many-to-many-create-functionality",hide_table_of_contents:!0},d=void 0,l={},r=[{value:"CREATE: Adding <code>Create()</code> Actions to the <code>TagsController</code> and Corresponding View",id:"create-adding-create-actions-to-the-tagscontroller-and-corresponding-view",level:2},{value:"CREATE: Adding <code>AddItem()</code> Actions to the <code>TagsController</code> and Corresponding View",id:"create-adding-additem-actions-to-the-tagscontroller-and-corresponding-view",level:2},{value:"CREATE: Adding <code>AddTag()</code> Actions to the <code>ItemsController</code> and Corresponding View",id:"create-adding-addtag-actions-to-the-itemscontroller-and-corresponding-view",level:2},{value:"Repository Reference",id:"repository-reference",level:3}];function c(e){const n={a:"a",code:"code",div:"div",h2:"h2",h3:"h3",hr:"hr",i:"i",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["In the last lesson, we added read functionality for our new ",(0,i.jsx)(n.code,{children:"Tag"})," class. In this lesson, we'll add create functionality in order to make new tags. We'll also add routes and views to make it possible to create a many-to-many association between tags and items from both the ",(0,i.jsx)(n.code,{children:"TagsController"})," and ",(0,i.jsx)(n.code,{children:"ItemsController"}),"."]}),"\n",(0,i.jsxs)(n.h2,{id:"create-adding-create-actions-to-the-tagscontroller-and-corresponding-view",children:["CREATE: Adding ",(0,i.jsx)(n.code,{children:"Create()"})," Actions to the ",(0,i.jsx)(n.code,{children:"TagsController"})," and Corresponding View"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:["We'll start by adding the ability to create tags. Let's start by adding the ",(0,i.jsx)(n.code,{children:"Create()"})," GET and POST actions to the ",(0,i.jsx)(n.code,{children:"TagsController"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Here's the code that we'll add:"}),"\n",(0,i.jsx)(n.div,{className:"filename",children:"Controllers/TagsController.cs"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'...\n\n    public ActionResult Create()\n    {\n      return View();\n    }\n\n    [HttpPost]\n    public ActionResult Create(Tag tag)\n    {\n      _db.Tags.Add(tag);\n      _db.SaveChanges();\n      return RedirectToAction("Index");\n    }\n\n...\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The above code should look familiar from the ",(0,i.jsx)(n.code,{children:"Create()"})," actions we've added to the ",(0,i.jsx)(n.code,{children:"ItemsController"})," and ",(0,i.jsx)(n.code,{children:"CategoriesController"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Next, let's add a view for our ",(0,i.jsx)(n.code,{children:"Create()"})," action. Create a new file called ",(0,i.jsx)(n.code,{children:"Create.cshtml"})," in the ",(0,i.jsx)(n.code,{children:"Views/Tags/"})," subdirectory and add the following code:"]}),"\n",(0,i.jsx)(n.div,{className:"filename",children:"Views/Tags/Create.cshtml"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'@{\n  Layout = "_Layout";\n}\n\n@model ToDoList.Models.Tag\n\n<h4>Add a new tag</h4>\n\n@using (Html.BeginForm())\n{\n    @Html.LabelFor(model => model.Title)\n    @Html.TextBoxFor(model => model.Title)\n\n    <input type="submit" value="Add new tag" class="btn btn-primary" />\n}\n<p>@Html.ActionLink("Show all tags", "Index")</p>\n'})}),"\n",(0,i.jsx)(n.p,{children:"Note that we are not adding the ability to create a many-to-many association between items and tags to the tag's create page. These two creation actions should be separate. In other words, we should be able to create a tag without needing to also create a many-to-many association with an item."}),"\n",(0,i.jsxs)(n.p,{children:["Let's finish up by adding a link to our new ",(0,i.jsx)(n.code,{children:"Create"})," route to our tag's ",(0,i.jsx)(n.code,{children:"Index.cshtml"}),":"]}),"\n",(0,i.jsx)(n.div,{className:"filename",children:"Views/Tags/Index.cshtml"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'...\n<p>@Html.ActionLink("Add new tag", "Create")</p>\n'})}),"\n",(0,i.jsxs)(n.h2,{id:"create-adding-additem-actions-to-the-tagscontroller-and-corresponding-view",children:["CREATE: Adding ",(0,i.jsx)(n.code,{children:"AddItem()"})," Actions to the ",(0,i.jsx)(n.code,{children:"TagsController"})," and Corresponding View"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:["Next, let's add the ability to create many-to-many associations between tags and items. To do this, we'll add new ",(0,i.jsx)(n.code,{children:"AddItem()"})," GET and POST actions and a corresponding view."]}),"\n",(0,i.jsxs)(n.p,{children:["Let's start by adding the ",(0,i.jsx)(n.code,{children:"TagsController"})," actions. Here's the code we'll add:"]}),"\n",(0,i.jsx)(n.div,{className:"filename",children:"Controllers/TagsController.cs"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'...\n\n    public ActionResult AddItem(int id)\n    {\n      Tag thisTag = _db.Tags.FirstOrDefault(tags => tags.TagId == id);\n      ViewBag.ItemId = new SelectList(_db.Items, "ItemId", "Description");\n      return View(thisTag);\n    }\n\n    [HttpPost]\n    public ActionResult AddItem(Tag tag, int itemId)\n    {\n      #nullable enable\n      ItemTag? joinEntity = _db.ItemTags.FirstOrDefault(join => (join.ItemId == itemId && join.TagId == tag.TagId));\n      #nullable disable\n      if (joinEntity == null && itemId != 0)\n      {\n        _db.ItemTags.Add(new ItemTag() { ItemId = itemId, TagId = tag.TagId });\n        _db.SaveChanges();\n      }\n      return RedirectToAction("Details", new { id = tag.TagId });\n    }\n\n...\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The code in the ",(0,i.jsx)(n.code,{children:"AddItem()"})," GET action should be familiar: we get the tag that we want to associate with an item along with a list of all items and pass each into the view."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"AddItem()"})," POST action contains some new code to ensure that we don't create a join relationship in two scenarios: when there's no item in the select list with which to create a join relationship, and when a join relationship between a tag and item already exists. If either of these scenarios are true, that means we don't want to create a new join relationship and we simply route back to the details page."]}),"\n",(0,i.jsxs)(n.p,{children:["For the first scenario, to prevent the creation of a join relationship when there's no item in the select list, all we need to do is double check the value of ",(0,i.jsx)(n.code,{children:"itemId"}),": if it's equal to ",(0,i.jsx)(n.code,{children:"0"}),", there's no item in the select list with which to create a join relationship. We do this in the if statement with the condition ",(0,i.jsx)(n.code,{children:"itemId != 0"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"For the second scenario, to prevent creating duplicate join relationships we need to go through a process of checking whether the join relationship already exists. This is where the new code comes in:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:"      #nullable enable\n      ItemTag? joinEntity = _db.ItemTags.FirstOrDefault(join => (join.ItemId == itemId && join.TagId == tag.TagId));\n      #nullable disable\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["We create a database query with the ",(0,i.jsx)(n.code,{children:"FirstOrDefault()"})," method that returns the first ",(0,i.jsx)(n.code,{children:"ItemTag"})," object that contains a matching ",(0,i.jsx)(n.code,{children:"ItemId"})," and ",(0,i.jsx)(n.code,{children:"TagId"}),"; if a matching ",(0,i.jsx)(n.code,{children:"ItemTag"})," object can't be found, the default is returned, which is ",(0,i.jsx)(n.code,{children:"null"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Since our ",(0,i.jsx)(n.code,{children:"joinEntity"})," variable will be either an ",(0,i.jsx)(n.code,{children:"ItemTag"})," object or ",(0,i.jsx)(n.code,{children:"null"}),", we need to make it a nullable type. We can turn a type into a ",(0,i.jsx)(n.strong,{children:"nullable type"})," by adding a question mark ",(0,i.jsx)(n.code,{children:"?"})," at the end of the type, like ",(0,i.jsx)(n.code,{children:"ItemTag?"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["To use nullable reference types in particular, we must also have a nullable annotation context enabled so that our C# compiler can process the nullable reference types. We can enable a nullable annotation context for our entire app via our ",(0,i.jsx)(n.code,{children:".csproj"})," file, or for a file or a few lines of code with nullable directives: ",(0,i.jsx)(n.code,{children:"#nullable enable"})," and ",(0,i.jsx)(n.code,{children:"#nullable disable"}),". We're opting for the latter in our code because it will require less refactoring across our whole app."]}),"\n",(0,i.jsxs)(n.li,{children:["To complete the checking process for duplicate join relationships, we simply need to check if ",(0,i.jsx)(n.code,{children:"joinEntity == null"})," in our conditional. If the result of our search for duplicates is ",(0,i.jsx)(n.code,{children:"null"}),", it means that we can move forward with creating the new join relationship in our database."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["To review more information about nullable types, start with the LearnHowToProgram.com lesson on ",(0,i.jsx)(n.a,{href:"../../c-and-net/test-driven-development-with-c/3-1-2-6-nullable-types",children:"Nullable Types"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Note that we can also check if a join relationship has already been saved to the database using the ",(0,i.jsx)(n.code,{children:"Enumerable.Contains()"})," method and a custom equality comparer. To learn how to do this, visit ",(0,i.jsxs)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/system.linq.enumerable.contains?view=net-6.0#system-linq-enumerable-contains-1(system-collections-generic-ienumerable((-0))-0-system-collections-generic-iequalitycomparer((-0)))",children:["this section of the ",(0,i.jsx)(n.code,{children:"Enumerable.Contains()"})," docs"]}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Next, let's add our ",(0,i.jsx)(n.code,{children:"AddItem.cshtml"})," view. Go ahead and create this file now within the ",(0,i.jsx)(n.code,{children:"Views/Tags"})," subdirectory and add the following code:"]}),"\n",(0,i.jsx)(n.div,{className:"filename",children:"Views/Tags/AddItem.cshtml"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'@{\n  Layout = "_Layout";\n}\n\n@model ToDoList.Models.Tag\n\n<h2>Add an item</h2>\n\n<h4>Add an item to this tag: @Html.DisplayFor(model => model.Title)</h4>\n\n@using (Html.BeginForm())\n{\n    @Html.HiddenFor(model => model.TagId)\n\n    @Html.Label("Select item")\n    @Html.DropDownList("ItemId")\n\n    <input type="submit" value="Save" />\n}\n\n<p>@Html.ActionLink("Back to list", "Index")</p>\n'})}),"\n",(0,i.jsx)(n.p,{children:"The above code should look familiar from the form we created to add new items with a one-to-many association with a category. In this case, we're providing a select list of items that a user can select from to associate an item with a tag in a many-to-many relationship."}),"\n",(0,i.jsxs)(n.p,{children:["Finally, let's finish up by adding a link to our new ",(0,i.jsx)(n.code,{children:"AddItem"})," route to our tag's ",(0,i.jsx)(n.code,{children:"Details.cshtml"}),":"]}),"\n",(0,i.jsx)(n.div,{className:"filename",children:"Views/Tags/Details.cshtml"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'...\n<p>@Html.ActionLink("Add an Item", "AddItem", new { id = Model.TagId })</p>\n'})}),"\n",(0,i.jsxs)(n.p,{children:["And with that, we can now create join relationships from the ",(0,i.jsx)(n.code,{children:"TagsController"}),". Up next, we'll add the same functionality to the ",(0,i.jsx)(n.code,{children:"ItemsController"}),"."]}),"\n",(0,i.jsxs)(n.h2,{id:"create-adding-addtag-actions-to-the-itemscontroller-and-corresponding-view",children:["CREATE: Adding ",(0,i.jsx)(n.code,{children:"AddTag()"})," Actions to the ",(0,i.jsx)(n.code,{children:"ItemsController"})," and Corresponding View"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsxs)(n.p,{children:["The process of adding the ability to create join relationships via our ",(0,i.jsx)(n.code,{children:"Items"})," controller and views will be  the same as doing this via the ",(0,i.jsx)(n.code,{children:"Tags"})," controller and views, except different variable names and types. Because of this, we won't re-explain each update we make."]}),"\n",(0,i.jsxs)(n.p,{children:["We'll start out by adding ",(0,i.jsx)(n.code,{children:"AddTag()"})," GET and POST actions to our ",(0,i.jsx)(n.code,{children:"ItemsController.cs"}),":"]}),"\n",(0,i.jsx)(n.div,{className:"filename",children:"Controllers/ItemsController.cs"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'...\n\n    public ActionResult AddTag(int id)\n    {\n      Item thisItem = _db.Items.FirstOrDefault(items => items.ItemId == id);\n      ViewBag.TagId = new SelectList(_db.Tags, "TagId", "Title");\n      return View(thisItem);\n    }\n\n    [HttpPost]\n    public ActionResult AddTag(Item item, int tagId)\n    {\n      #nullable enable\n      ItemTag? joinEntity = _db.ItemTags.FirstOrDefault(join => (join.TagId == tagId && join.ItemId == item.ItemId));\n      #nullable disable\n      if (joinEntity == null && tagId != 0)\n      {\n        _db.ItemTags.Add(new ItemTag() { TagId = tagId, ItemId = item.ItemId });\n        _db.SaveChanges();\n      }\n      return RedirectToAction("Details", new { id = item.ItemId });\n    }  \n\n...\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Next, we'll add the ",(0,i.jsx)(n.code,{children:"AddTag.cshtml"})," view. Go ahead and create this file now within the ",(0,i.jsx)(n.code,{children:"Views/Items"})," subdirectory and add the following code:"]}),"\n",(0,i.jsx)(n.div,{className:"filename",children:"Views/Items/AddTag.cshtml"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-html",children:'@{\n  Layout = "_Layout";\n}\n\n@model ToDoList.Models.Item\n\n<h2>Add a tag</h2>\n\n<h4>Add a tag to this item: @Html.DisplayFor(model => model.Description)</h4>\n\n@using (Html.BeginForm())\n{\n    @Html.HiddenFor(model => model.ItemId)\n\n    @Html.Label("Select tag")\n    @Html.DropDownList("TagId")\n\n    <input type="submit" value="Save" />\n}\n\n<p>@Html.ActionLink("Back to list", "Index")</p>\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Once again, let's finish up by adding a link to our new ",(0,i.jsx)(n.code,{children:"AddTag"})," route to our item's ",(0,i.jsx)(n.code,{children:"Details.cshtml"}),":"]}),"\n",(0,i.jsx)(n.div,{className:"filename",children:"Views/Items/Details.cshtml"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-csharp",children:'...\n<p>@Html.ActionLink("Add a Tag", "AddTag", new { id = Model.ItemId })</p>\n'})}),"\n",(0,i.jsx)(n.p,{children:"Now if we run our project, we'll be able to create and view tag objects as well as join relationships between tags and items."}),"\n",(0,i.jsx)(n.h3,{id:"repository-reference",children:"Repository Reference"}),"\n",(0,i.jsx)(n.p,{children:"Follow the link below to view how a sample version of the project should look at this point. Note that this is a link to a specific branch in the repository."}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsxs)(n.a,{href:"https://github.com/epicodus-lessons/section-4-to-do-list-with-many-to-many-csharp-net6/tree/3_m2m_read_and_create",children:[(0,i.jsx)(n.i,{className:"glyphicon glyphicon-folder-open"}),"  GitHub Repo for To Do List with EF Core Migrations and a Many-to-Many Relationship: 3_m2m_read_and_create"]})})})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);
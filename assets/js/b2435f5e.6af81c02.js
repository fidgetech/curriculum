"use strict";(self.webpackChunklhtp=self.webpackChunklhtp||[]).push([[96615],{28453:(e,t,i)=>{i.d(t,{R:()=>a,x:()=>r});var n=i(96540);const s={},o=n.createContext(s);function a(e){const t=n.useContext(o);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),n.createElement(o.Provider,{value:t},e.children)}},53275:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>c});const n=JSON.parse('{"id":"react/team-week/3-6-0-4-rewriting-history-with-git","title":"\ud83d\udcd3 3.6.0.4 Rewriting History with Git","description":"We always want to include clear and detailed messages with our commits. However, even the most careful developers can make mistakes. Thankfully, git offers several options to re-write commits.","source":"@site/versioned_docs/version-WIP/3_react/6_team-week/3-6-0-04-rewriting-history-with-git.md","sourceDirName":"3_react/6_team-week","slug":"/react/team-week/3-6-0-4-rewriting-history-with-git","permalink":"/WIP/react/team-week/3-6-0-4-rewriting-history-with-git","draft":false,"unlisted":false,"tags":[],"version":"WIP","frontMatter":{"title":"\ud83d\udcd3 3.6.0.4 Rewriting History with Git","day":"weekend","id":"3-6-0-4-rewriting-history-with-git","hide_table_of_contents":true},"sidebar":"react","previous":{"title":"\ud83d\udcd3 3.6.0.3 Git with Collaborators: Workflow","permalink":"/WIP/react/team-week/3-6-0-3-git-with-collaborators-workflow"},"next":{"title":"\ud83d\udcd3 3.6.0.5 Learning More About Git","permalink":"/WIP/react/team-week/3-6-0-5-learning-more-about-git"}}');var s=i(74848),o=i(28453);const a={title:"\ud83d\udcd3 3.6.0.4 Rewriting History with Git",day:"weekend",id:"3-6-0-4-rewriting-history-with-git",hide_table_of_contents:!0},r=void 0,l={},c=[{value:"git log --oneline",id:"git-log---oneline",level:2},{value:"git commit --amend",id:"git-commit---amend",level:2},{value:"git rebase -i",id:"git-rebase--i",level:2},{value:"Changing old commit messages with git rebase -i",id:"changing-old-commit-messages-with-git-rebase--i",level:4},{value:"Combining Multiple Commits with git rebase -i",id:"combining-multiple-commits-with-git-rebase--i",level:4},{value:"Pushing Rewritten History to GitHub",id:"pushing-rewritten-history-to-github",level:2},{value:"Rebasing to Clean Merge",id:"rebasing-to-clean-merge",level:2}];function d(e){const t={a:"a",code:"code",em:"em",h2:"h2",h4:"h4",hr:"hr",p:"p",pre:"pre",strong:"strong",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"We always want to include clear and detailed messages with our commits. However, even the most careful developers can make mistakes. Thankfully, git offers several options to re-write commits."}),"\n",(0,s.jsxs)(t.p,{children:["But first, note that we need to be very careful when modifying Git history. This is especially true if you are working collaboratively with others: If you modify an existing commit, it actually ",(0,s.jsx)(t.em,{children:"removes"})," the old commit from the project and makes a ",(0,s.jsx)(t.em,{children:"new"})," one in its place. If others are working on the same branch they will still have your old commits when they pull down any changes, and will be asked to merge your ",(0,s.jsx)(t.em,{children:"rewritten"})," commits with your ",(0,s.jsx)(t.em,{children:"new"})," commits. This can create a real mess. For that reason, ",(0,s.jsx)(t.strong,{children:"you should not modify commit history on a branch others are also working on"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["However, in some circumstances it is necessary to modify your ",(0,s.jsx)(t.strong,{children:"local"})," commit history (that is, commits that exist locally on your machine, but have not been pushed to Github yet) before pushing your repository. In this lesson, we'll cover several ways to make changes to your Git commit history."]}),"\n",(0,s.jsx)(t.h2,{id:"git-log---oneline",children:"git log --oneline"}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsxs)(t.p,{children:["We can see a project's commit history with the ",(0,s.jsx)(t.code,{children:"git log"})," command. And we can add the ",(0,s.jsx)(t.code,{children:"--oneline"})," flag to display the history in an easier to read format:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"$ git log --oneline\nd7e33de something css related\n32ccc0b do something with html\n9db82b6 update readme\n79e9de2 add readme\n827ad58 add initial files\n"})}),"\n",(0,s.jsx)(t.p,{children:"We can see that this project contains some poorly-worded commits. There are also two consecutive commits about the same feature. Let's clean up this Git commit history!"}),"\n",(0,s.jsx)(t.h2,{id:"git-commit---amend",children:"git commit --amend"}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsxs)(t.p,{children:["First we'll learn how to modify the ",(0,s.jsx)(t.strong,{children:"most recent"})," commit. Let's say we committed the right files, but we messed up the commit message. In this case we can use ",(0,s.jsx)(t.code,{children:"git commit --amend"})," to simply update the commit message:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:'$ git commit --amend -m "add styling to main page"\n'})}),"\n",(0,s.jsx)(t.p,{children:'This changes the commit message on the most recent commit from "something css related"  (as seen in the git log above) to "add styling to main page". Note that it also assigns that commit a new id, since it deleted the old commit and created a new one in its place. The Git history reflects the change:'}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"$ git log --oneline\n6ad9b62 add styling to main page\n32ccc0b do something with html\n9db82b6 update readme\n79e9de2 add readme\n827ad58 add initial files\n"})}),"\n",(0,s.jsxs)(t.p,{children:["If we accidentally forgot to include a file in the previous commit, we could also use  ",(0,s.jsx)(t.code,{children:"git commit --amend"})," to add a file to the previous commit:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:'$ git add index.html\n$ git commit --amend -m "add styling to main page"\n'})}),"\n",(0,s.jsx)(t.h2,{id:"git-rebase--i",children:"git rebase -i"}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"git commit --amend"})," is an easy way to modify our most recent commit, but if we need to modify history going ",(0,s.jsx)(t.em,{children:"further"})," back then we'll need to use the powerful (but potentially dangerous!) ",(0,s.jsx)(t.code,{children:"git rebase -i"})," command."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.code,{children:"git rebase -i"}),' allows us to change commit messages and combine multiple commits by "squashing" them together. Be particularly careful with this command. It permanently deletes all commits from the point you\'re modifying onward, replacing them with new commits.']}),"\n",(0,s.jsx)(t.h4,{id:"changing-old-commit-messages-with-git-rebase--i",children:"Changing old commit messages with git rebase -i"}),"\n",(0,s.jsxs)(t.p,{children:["Now, let's reword our second-to-last commit's message. If we type ",(0,s.jsx)(t.code,{children:"git rebase -i HEAD~2"})," it will launch the system editor, where we'll see a Git rebase file containing the two most recent commits. It will look something like this:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"pick 32ccc0b do something with html\npick 6ad9b62 add styling to main page\n"})}),"\n",(0,s.jsxs)(t.p,{children:["To reword some of the commit messages, we can change ",(0,s.jsx)(t.code,{children:"pick"})," before those lines to ",(0,s.jsx)(t.code,{children:"reword"}),", as follows:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"reword 32ccc0b do something with html\npick 6ad9b62 add styling to main page\n"})}),"\n",(0,s.jsx)(t.p,{children:"When we save and close that file, we're immediately presented with a commit message file in the editor, allowing us to update the commit message we marked for rewording:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"do something with html\n\n# Please enter the commit message for your changes. Lines starting\n# with '#' will be ignored, and an empty message aborts the commit.\n#\n# Date:      Sat Mar 19 10:56:31 2016 -0700\n#\n# rebase in progress; onto 9db82b6\n# You are currently editing a commit while rebasing branch 'main' on '9db82b6'.\n#\n# Changes to be committed:\n#       modified:   index.html\n#\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Let's change the commit message at the top to ",(0,s.jsx)(t.em,{children:"add welcome message to index.html"}),". We save and close the file, and now the changes are reflected in the Git history:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"$ git log --oneline\n0e3e0bc add styling to main page\n1a940bb add welcome message to index.html\n9db82b6 update readme\n79e9de2 add readme\n827ad58 add initial files\n"})}),"\n",(0,s.jsx)(t.p,{children:"Note that the last two commits (the two we rebased) now have new id's, because the old commits were deleted and replaced with new ones."}),"\n",(0,s.jsx)(t.h4,{id:"combining-multiple-commits-with-git-rebase--i",children:"Combining Multiple Commits with git rebase -i"}),"\n",(0,s.jsx)(t.p,{children:'Now, let\'s say we want to combine multiple commits for one feature into a single commit before publishing to Github. We want to combine the "add readme" and "update readme" commits.'}),"\n",(0,s.jsxs)(t.p,{children:["We can type ",(0,s.jsx)(t.code,{children:"git rebase -i HEAD~4"})," to bring up the four most recent commits in the rebase editor window. To combine a commit with the previous commit, we can change ",(0,s.jsx)(t.code,{children:"pick"})," to ",(0,s.jsx)(t.code,{children:"squash"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Let's change ",(0,s.jsx)(t.code,{children:"pick"})," to ",(0,s.jsx)(t.code,{children:"squash"}),' on the "update readme" commit in order to combine that one with the "add readme" commit directly preceding it:']}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"pick 79e9de2 add readme\nsquash 9db82b6 update readme\npick 1a940bb add welcome message to index.html\npick 0e3e0bc add styling to main page\n"})}),"\n",(0,s.jsxs)(t.p,{children:["After saving and closing this file, we're presented with a commit message file. We can write the commit message for the new ",(0,s.jsx)(t.em,{children:"combined"})," commit in this file:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"# This is a combination of 2 commits.\n# The first commit's message is:\n\nadd readme\n\n# This is the 2nd commit message:\n\nupdate readme\n\n"})}),"\n",(0,s.jsx)(t.p,{children:'We can update the first commit message to "create project readme" and simply delete the "update readme" line, since we\'re eliminating the second commit from our project:'}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"# This is a combination of 2 commits.\n# The first commit's message is:\n\ncreate project readme\n\n# This is the 2nd commit message:\n\n"})}),"\n",(0,s.jsx)(t.p,{children:"After saving and closing that file, the Git history reflects the change:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"$ git history --oneline\n59e7083 add styling to main page\n2b1b367 add welcome message to index.html\n4c876ed create project readme\n827ad58 add initial files\n"})}),"\n",(0,s.jsx)(t.h2,{id:"pushing-rewritten-history-to-github",children:"Pushing Rewritten History to GitHub"}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsxs)(t.p,{children:["Again, be extremely careful when changing history on a public repository. Do not make history changes to a remote repository being worked on by other developers. However, you may push rewritten history to a public repository if you're the ",(0,s.jsx)(t.em,{children:"only"})," developer working on it."]}),"\n",(0,s.jsx)(t.p,{children:"Normally you'll receive the following error if you push a project to Github, rewrite history, and then attempt to push the project again:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-shell",children:"$ git push origin main\nTo https://github.com/epicodus-lessons/hello\n ! [rejected]        main -> main (non-fast-forward)\nerror: failed to push some refs to 'https://github.com/epicodus-lessons/hello'\nhint: Updates were rejected because the tip of your current branch is behind\nhint: its remote counterpart. Integrate the remote changes (e.g.\nhint: 'git pull ...') before pushing again.\nhint: See the 'Note about fast-forwards' in 'git push --help' for details.\n"})}),"\n",(0,s.jsxs)(t.p,{children:["This is simply because the local commits and remote commits no longer match. In order to force Github to throw away the old version of the project and replace it with the newly-edited local commit history, you must use the ",(0,s.jsx)(t.code,{children:"--force"})," option:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"$ git push origin main --force\n"})}),"\n",(0,s.jsx)(t.h2,{id:"rebasing-to-clean-merge",children:"Rebasing to Clean Merge"}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsxs)(t.p,{children:["Note that ",(0,s.jsx)(t.code,{children:"git rebase"})," without the ",(0,s.jsx)(t.code,{children:"-i"}),' flag is often used for doing a "clean merge" of different branches. We won\'t cover this concept yet, simply know this option exists in case you encounter it in the future.']}),"\n",(0,s.jsxs)(t.p,{children:["Or, if you'd like to explore it now, you can find more information ",(0,s.jsx)(t.a,{href:"https://www.atlassian.com/git/tutorials/rewriting-history/git-rebase",children:"here"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,o.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);
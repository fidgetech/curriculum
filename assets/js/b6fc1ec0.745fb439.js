"use strict";(self.webpackChunklhtp=self.webpackChunklhtp||[]).push([[86901],{28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>r});var s=t(96540);const o={},i=s.createContext(o);function a(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),s.createElement(i.Provider,{value:n},e.children)}},42080:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"c-and-net/authentication-with-identity/3-5-2-1-making-an-api-call-with-restsharp","title":"\ud83d\udcd3 3.5.2.1 Making an API Call with RestSharp","description":"In this lesson, we\'ll learn how to make an API call with a console application and a popular REST API client library called RestSharp. We will start with a console application in order to focus on learning the basic process of making an API call and parsing the response. Then we\'ll practice making API calls from an ASP.NET Core MVC app.","source":"@site/versioned_docs/version-v1_3/3_c-and-net/5_authentication-with-identity/3-5-2-01-making-an-api-call-with-restsharp.md","sourceDirName":"3_c-and-net/5_authentication-with-identity","slug":"/c-and-net/authentication-with-identity/3-5-2-1-making-an-api-call-with-restsharp","permalink":"/v1.3/c-and-net/authentication-with-identity/3-5-2-1-making-an-api-call-with-restsharp","draft":false,"unlisted":false,"tags":[],"version":"v1_3","frontMatter":{"title":"\ud83d\udcd3 3.5.2.1 Making an API Call with RestSharp","day":"tuesday","id":"3-5-2-1-making-an-api-call-with-restsharp","hide_table_of_contents":true},"sidebar":"c-and-net","previous":{"title":"\ud83d\udcd3 3.5.1.4 Jokes and Appropriate Humor","permalink":"/v1.3/c-and-net/authentication-with-identity/3-5-1-4-jokes-and-appropriate-humor"},"next":{"title":"\ud83d\udcd3 3.5.2.2 Deserializing API Responses with Newtonsoft.Json","permalink":"/v1.3/c-and-net/authentication-with-identity/3-5-2-2-deserializing-api-responses-with-newtonsoft-json"}}');var o=t(74848),i=t(28453);const a={title:"\ud83d\udcd3 3.5.2.1 Making an API Call with RestSharp",day:"tuesday",id:"3-5-2-1-making-an-api-call-with-restsharp",hide_table_of_contents:!0},r=void 0,l={},c=[{value:"Project Setup",id:"project-setup",level:2},{value:"Creating Basic Project Files and Folders",id:"creating-basic-project-files-and-folders",level:3},{value:"A Few Notes on Using the <code>dotnet new</code> Scaffolding Tool",id:"a-few-notes-on-using-the-dotnet-new-scaffolding-tool",level:3},{value:"Add RestSharp",id:"add-restsharp",level:3},{value:"Create an Environment Variable for the API Key",id:"create-an-environment-variable-for-the-api-key",level:3},{value:"Adding Code To Make An API Call",id:"adding-code-to-make-an-api-call",level:2},{value:"Run the Program",id:"run-the-program",level:2},{value:"Repository Reference",id:"repository-reference",level:3}];function d(e){const n={a:"a",code:"code",div:"div",em:"em",h2:"h2",h3:"h3",hr:"hr",i:"i",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["In this lesson, we'll learn how to make an API call with a console application and a popular REST API client library called ",(0,o.jsx)(n.a,{href:"https://restsharp.dev/",children:"RestSharp"}),". We will start with a console application in order to focus on learning the basic process of making an API call and parsing the response. Then we'll practice making API calls from an ASP.NET Core MVC app."]}),"\n",(0,o.jsx)(n.p,{children:"In the following lessons we'll also learn how to deserialize the JSON that's returned from (most) API calls. Throughout the lessons, we'll learn how to protect our API keys."}),"\n",(0,o.jsx)(n.h2,{id:"project-setup",children:"Project Setup"}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.p,{children:["We'll use the New York Times' Top Stories API for this example project. In order to use the Top Stories API, you'll need to create a free ",(0,o.jsx)(n.a,{href:"https://developer.nytimes.com/",children:"New York Times developer account"}),". Follow the ",(0,o.jsx)(n.a,{href:"https://developer.nytimes.com/get-started",children:"Get Started"})," steps to create an application and get your own API key. We recommend doing this first as API keys can sometimes take a little while to become activated."]}),"\n",(0,o.jsx)(n.h3,{id:"creating-basic-project-files-and-folders",children:"Creating Basic Project Files and Folders"}),"\n",(0,o.jsxs)(n.p,{children:["For this example project you may build your own console app from scratch or use the ",(0,o.jsx)(n.code,{children:"dotnet new"})," project scaffolding tool. A tool that scaffolds a project for us builds the folders and files with some boilerplate code, and it's a handy way to get started quickly on a new project. We'll use this tool again in future projects, so you will have a chance to practice with it at some point. More information on using the scaffolding tool is below."]}),"\n",(0,o.jsxs)(n.p,{children:["If you opt to build your own console app from scratch, build out this project structure to start and make sure to add the appropriate code to the ",(0,o.jsx)(n.code,{children:"ConsoleApiCall.csproj"})," file:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"ConsoleApiCall\n\u251c\u2500\u2500 Models/\n\u251c\u2500\u2500 Program.cs\n\u2514\u2500\u2500 ConsoleApiCall.csproj\n"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"Don't initialize or save your changes to Git until you've completed the setup steps for protecting your API key."})}),"\n",(0,o.jsxs)(n.h3,{id:"a-few-notes-on-using-the-dotnet-new-scaffolding-tool",children:["A Few Notes on Using the ",(0,o.jsx)(n.code,{children:"dotnet new"})," Scaffolding Tool"]}),"\n",(0,o.jsxs)(n.p,{children:["To use the ",(0,o.jsx)(n.code,{children:"dotnet new"})," project scaffolding tool, open the command line, navigate to your desktop or another destination folder, and enter in the following command:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ dotnet new console -o ConsoleApiCall -f net6.0\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Note that the ",(0,o.jsx)(n.code,{children:"-o"}),' flag allows us to specify the "output directory", the directory where all of the scaffolded files will be added. The ',(0,o.jsx)(n.code,{children:"-f"})," flag allows us to specify the framework version we want our project to use."]}),"\n",(0,o.jsxs)(n.p,{children:["It's also important to note that the ",(0,o.jsx)(n.code,{children:"dotnet new"})," scaffolding tool generates its console apps with a few newer features enabled:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Implicit ",(0,o.jsx)(n.code,{children:"using"}),"s are enabled, which allows us to avoid having to explicitly list using directives."]}),"\n",(0,o.jsxs)(n.li,{children:["Nullable types are enabled, which allows us to use nullable types anywhere in our program. If we don't enable nullable types globally through the ",(0,o.jsx)(n.code,{children:".csproj"})," file, then we have to explicitly create nullable contexts with ",(0,o.jsx)(n.code,{children:"#nullable enable"})," in the specific locations where we want to use nullable types."]}),"\n",(0,o.jsxs)(n.li,{children:["Top level statements are enabled, which makes it so that we don't need to explicitly include the entry point's ",(0,o.jsx)(n.code,{children:"Main()"})," method. Note that only one class in our project can have this method, and usually it is ",(0,o.jsx)(n.code,{children:"Program"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["The first two features correspond to settings that we can enable for our entire app in our project's ",(0,o.jsx)(n.code,{children:".csproj"}),". The third feature is always enabled, and optional:"]}),"\n",(0,o.jsx)(n.div,{className:"filename",children:"ConsoleApiCall.csproj"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:'<Project Sdk="Microsoft.NET.Sdk">\n\n  <PropertyGroup>\n    <OutputType>Exe</OutputType>\n    <TargetFramework>net6.0</TargetFramework>\n    <ImplicitUsings>enable</ImplicitUsings>\n    <Nullable>enable</Nullable>\n  </PropertyGroup>\n\n</Project>\n'})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"We're going to opt out of these features for now."})," This is in order to..."]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsx)(n.li,{children:"Understand which using directives we need to use certain tools."}),"\n",(0,o.jsx)(n.li,{children:"Remind ourselves about C# console app's entry point."}),"\n",(0,o.jsxs)(n.li,{children:["Avoid managing nullable variables throughout our app. When nullable types are enabled, we need to explicitly list which types could be ",(0,o.jsx)(n.code,{children:"null"})," in our apps, which is a lot more than you might think. For example, ",(0,o.jsxs)(n.a,{href:"https://learn.microsoft.com/en-us/dotnet/api/system.console.readline?view=net-6.0",children:["the ",(0,o.jsx)(n.code,{children:"System.Console.ReadLine()"})," method"]})," returns the user input, or ",(0,o.jsx)(n.code,{children:"null"})," if there's nothing returned. If nullable types are enabled across our app, we would need to make sure that we're explicitly marking the variable that holds the user input as nullable: ",(0,o.jsx)(n.code,{children:"string? userResponse = System.Console.ReadLine();"}),". When nullable types are not enabled we don't have to do this additional work. Since we haven't spent a lot of time working with nullable types, it's easier right now to simply enable them as needed in our app, instead of as a setting for our whole app. To review more information about nullable types, start with the LearnHowToProgram.com lesson on ",(0,o.jsx)(n.a,{href:"../../c-and-net/test-driven-development-with-c/3-1-2-6-nullable-types",children:"Nullable Types"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Make sure to remove or comment out these configurations in your ",(0,o.jsx)(n.code,{children:"ConsoleApiCall.csproj"}),":"]}),"\n",(0,o.jsx)(n.div,{className:"filename",children:"ConsoleApiCall.csproj"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:'<Project Sdk="Microsoft.NET.Sdk">\n\n  <PropertyGroup>\n    <OutputType>Exe</OutputType>\n    <TargetFramework>net6.0</TargetFramework>\n    \x3c!-- <ImplicitUsings>enable</ImplicitUsings> --\x3e\n    \x3c!-- <Nullable>enable</Nullable> --\x3e\n  </PropertyGroup>\n\n</Project>\n'})}),"\n",(0,o.jsx)(n.p,{children:"Note that you are welcome to choose your own path with these configurations, but the instructions in these lessons will not include how using these features may affect the warning or errors you get in your app."}),"\n",(0,o.jsx)(n.h3,{id:"add-restsharp",children:"Add RestSharp"}),"\n",(0,o.jsx)(n.p,{children:"Next, Let's add the RestSharp package to our project:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"$ dotnet add package RestSharp --version 108.0.3\n"})}),"\n",(0,o.jsx)(n.h3,{id:"create-an-environment-variable-for-the-api-key",children:"Create an Environment Variable for the API Key"}),"\n",(0,o.jsx)(n.p,{children:"The last step for setup is to protect our API key in an environment variable. There are many ways we can do this, and we'll take a simple approach in this lesson."}),"\n",(0,o.jsxs)(n.p,{children:["First, we'll create a ",(0,o.jsx)(n.code,{children:".gitignore"})," with the file and folders listed within that we do not want tracked in our Git history:"]}),"\n",(0,o.jsx)(n.div,{className:"filename",children:".gitignore"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"EnvironmentVariables.cs\nobj\nbin\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Next, we'll commit the change we made to our ",(0,o.jsx)(n.code,{children:".gitignore"})," to our Git history."]}),"\n",(0,o.jsx)(n.p,{children:"Next, let's create the file that we've ignored. It's in this file that we'll put our API key."}),"\n",(0,o.jsx)(n.div,{className:"filename",children:"EnvironmentVariables.cs"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:'namespace ConsoleApiCall.Keys\n{\n  public static class EnvironmentVariables\n  {\n    public static string ApiKey = "[YOUR-API-KEY-HERE]";\n  }\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Replace ",(0,o.jsx)(n.code,{children:'"[YOUR-API-KEY-HERE]"'})," with your own API key."]}),"\n",(0,o.jsxs)(n.p,{children:["Wherever we need to use our API key in our application we can do so by adding a using directive for ",(0,o.jsx)(n.code,{children:"ConsoleApiCall.Keys"})," and calling ",(0,o.jsx)(n.code,{children:"EnvironmentVariables.ApiKey"}),". We'll do just that later in this lesson."]}),"\n",(0,o.jsxs)(n.p,{children:["Keep in mind that this is very basic protection for our API key. We could still accidentally commit our API key to our Git history and publish it to the web.  To learn about other ways we can manage secrets, visit the ",(0,o.jsx)(n.a,{href:"https://learn.microsoft.com/en-us/aspnet/core/security/app-secrets?view=aspnetcore-6.0",children:"MS Docs on application secrets"}),"."]}),"\n",(0,o.jsx)(n.h2,{id:"adding-code-to-make-an-api-call",children:"Adding Code To Make An API Call"}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.p,{children:["Open the ",(0,o.jsx)(n.code,{children:"ConsoleApiCall/"})," project directory in VS Code and we'll get started. The ",(0,o.jsx)(n.code,{children:"dotnet new"})," command has already added a basic ",(0,o.jsx)(n.code,{children:"Program.cs"})," file for us:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:'// See https://aka.ms/new-console-template for more information\nConsole.WriteLine("Hello, World!");\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Take note that the code in ",(0,o.jsx)(n.code,{children:"Program.cs"})," is making use of top-level statements and implicit using directives, which allows us to omit the ",(0,o.jsx)(n.code,{children:"Main()"})," method and not explicitly include the ",(0,o.jsx)(n.code,{children:"using System;"})," namespace directive to use the ",(0,o.jsx)(n.code,{children:"Console.WriteLine()"})," method."]}),"\n",(0,o.jsxs)(n.p,{children:["Let's update ",(0,o.jsx)(n.code,{children:"Program.cs"})," to include basic code to make an API call. We'll also explicitly list all of our using directives and our ",(0,o.jsx)(n.code,{children:"Program.Main()"})," method, the entry point to our C# console applications."]}),"\n",(0,o.jsxs)(n.p,{children:["Here's how we'll update ",(0,o.jsx)(n.code,{children:"Program.cs"}),":"]}),"\n",(0,o.jsx)(n.div,{className:"filename",children:"Program.cs"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-csharp",children:'using System;\nusing System.Threading.Tasks;\nusing RestSharp;\nusing ConsoleApiCall.Keys;\n\nnamespace ApiTest\n{\n  class Program \n  {\n    static void Main()\n    {\n      Task<string> apiCallTask = ApiHelper.ApiCall(EnvironmentVariables.ApiKey);\n      string result = apiCallTask.Result;\n      Console.WriteLine(result);\n    }\n  }\n\n  class ApiHelper\n  {\n    public static async Task<string> ApiCall(string apiKey)\n    {\n      RestClient client = new RestClient("https://api.nytimes.com/svc/topstories/v2");\n      RestRequest request = new RestRequest($"home.json?api-key={apiKey}", Method.Get);\n      RestResponse response = await client.ExecuteAsync(request);\n      return response.Content;\n    }\n  }\n}\n'})}),"\n",(0,o.jsx)(n.p,{children:"Let's take time to understand this new code, and then try running it afterwards."}),"\n",(0,o.jsxs)(n.p,{children:["We'll first take a look at the ",(0,o.jsx)(n.code,{children:"ApiCall"})," static method that we've created:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["We create a class called ",(0,o.jsx)(n.code,{children:"ApiHelper"})," that contains a static method ",(0,o.jsx)(n.code,{children:"ApiCall"})," which takes an ",(0,o.jsx)(n.code,{children:"apiKey"})," parameter."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["We want our API calls to run asynchronously so that the application is responsive and free to run other tasks while the HTTP request/response loop executes. In order to achieve this, we add the ",(0,o.jsx)(n.code,{children:"async"})," keyword to our method declaration."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Whenever a method is declared as ",(0,o.jsx)(n.code,{children:"async"}),", we need to return a ",(0,o.jsx)(n.code,{children:"Task"})," type. We specify the return type of our Task object (a ",(0,o.jsx)(n.code,{children:"string"}),") in the angle brackets, but a generic ",(0,o.jsx)(n.code,{children:"Task"})," can also be returned."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Note that we use the base URL ",(0,o.jsx)(n.em,{children:(0,o.jsx)(n.a,{href:"https://api.nytimes.com/svc/topstories/v2",children:"https://api.nytimes.com/svc/topstories/v2"})})," from the Top Stories API. We instantiate a RestSharp ",(0,o.jsx)(n.code,{children:"RestClient"})," object and store the connection in a variable called ",(0,o.jsx)(n.code,{children:"client"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Next, we create a ",(0,o.jsx)(n.code,{children:"RestRequest"})," object. This is our actual request. We include the path to the endpoint we are looking for (",(0,o.jsx)(n.code,{children:"home.json"}),") along with our API key.  We also specify that we will be using a GET Http method."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Note that we utilize C#'s string interpolation to place the ",(0,o.jsx)(n.code,{children:"apiKey"})," variable into the ",(0,o.jsx)(n.code,{children:"RestRequest"})," by placing a ",(0,o.jsx)(n.code,{children:"$"})," before a string and then placing any interpolated values in curly braces."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Then we use the ",(0,o.jsx)(n.code,{children:"await"})," keyword to specify that we need to receive a result before we attempt to define ",(0,o.jsx)(n.code,{children:"response"}),". We call the ",(0,o.jsx)(n.code,{children:"RestClient"}),"'s ",(0,o.jsx)(n.code,{children:"ExecuteAsync"})," method and pass in our request object."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Finally, we return the ",(0,o.jsx)(n.code,{children:"Content"})," property of the ",(0,o.jsx)(n.code,{children:"RestResponse response"})," variable, which is a string representation of the response content."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["Now, let's take a a look at the ",(0,o.jsx)(n.code,{children:"Program.Main()"})," method:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["In the ",(0,o.jsx)(n.code,{children:"Main()"})," method, we create a variable to store the returned ",(0,o.jsx)(n.code,{children:"Task<string>"})," from our ",(0,o.jsx)(n.code,{children:"async"})," function and then call the ",(0,o.jsx)(n.code,{children:"ApiHelper"})," class' ",(0,o.jsx)(n.code,{children:"ApiCall"})," method. It's here that we pass in our New York Times API key via our environment variable  ",(0,o.jsx)(n.code,{children:"EnvironmentVariables.ApiKey"}),"."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:["Then, we create a variable to store the ",(0,o.jsx)(n.code,{children:"Result"})," of the ",(0,o.jsx)(n.code,{children:"Task"}),", which in our case is a string representation of the API call's response content."]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsx)(n.p,{children:"Lastly, we write the result to the console."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"run-the-program",children:"Run the Program"}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsxs)(n.p,{children:["Next, run the program with ",(0,o.jsx)(n.code,{children:"dotnet run"}),". We'll get a long, very dense response that has all the data for the New York Times' top stories."]}),"\n",(0,o.jsxs)(n.p,{children:["To make better sense of this data, we can paste the response into a JSON formatter like this ",(0,o.jsx)(n.a,{href:"http://jsonviewer.stack.hu/",children:"one"}),'. Copy the data into the formatter and then click the "Format" button. Of course, Postman can help us read this data, too.']}),"\n",(0,o.jsx)(n.p,{children:"However, this isn't an ideal way to deal with API responses. In the next lesson, we'll learn how to parse and deserialize JSON data in our C# applications."}),"\n",(0,o.jsx)(n.h3,{id:"repository-reference",children:"Repository Reference"}),"\n",(0,o.jsx)(n.p,{children:"Follow the link below to view how a sample version of the project should look at this point. Note that this is a link to a specific branch in the repository."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:(0,o.jsxs)(n.a,{href:"https://github.com/epicodus-lessons/c-sharp-newyorktimes-api-call/tree/1_api_call_in_console_app",children:[(0,o.jsx)(n.i,{className:"glyphicon glyphicon-folder-open"})," Example GitHub Repo for Sample New York Times API Call: ",(0,o.jsx)(n.code,{children:"1_api_call_in_console_app"})]})})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);
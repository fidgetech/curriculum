"use strict";(self.webpackChunklhtp=self.webpackChunklhtp||[]).push([[17038],{28453:(e,t,n)=>{n.d(t,{R:()=>s,x:()=>r});var o=n(96540);const a={},i=o.createContext(a);function s(e){const t=o.useContext(i);return o.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),o.createElement(i.Provider,{value:t},e.children)}},95022:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>r,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>l});const o=JSON.parse('{"id":"c-and-net/database-basics/3-3-2-6-create-and-update-with-a-one-to-many-relationship","title":"\ud83d\udcd3 3.3.2.6 Create and Update with a One-To-Many Relationship","description":"Now it\'s time to update the rest of our application so that our users can actually associate a Category with an Item. We\'ll also make two other valuable updates: we\'ll list the Category that an Item belongs to on its details page, and we\'ll make an update to our CREATE action to prevent unhandled database errors.","source":"@site/docs/3_c-and-net/3_database-basics/3-3-2-06-create-and-update-with-a-one-to-many-relationship.md","sourceDirName":"3_c-and-net/3_database-basics","slug":"/c-and-net/database-basics/3-3-2-6-create-and-update-with-a-one-to-many-relationship","permalink":"/v1.2/c-and-net/database-basics/3-3-2-6-create-and-update-with-a-one-to-many-relationship","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"\ud83d\udcd3 3.3.2.6 Create and Update with a One-To-Many Relationship","day":"tuesday","id":"3-3-2-6-create-and-update-with-a-one-to-many-relationship","hide_table_of_contents":true},"sidebar":"c-and-net","previous":{"title":"\ud83d\udcd3 3.3.2.5 Using ViewBag","permalink":"/v1.2/c-and-net/database-basics/3-3-2-5-using-viewbag"},"next":{"title":"\u270f\ufe0f 3.3.3.1 Best Restaurants in Town","permalink":"/v1.2/c-and-net/database-basics/3-3-3-1-best-restaurants-in-town"}}');var a=n(74848),i=n(28453);const s={title:"\ud83d\udcd3 3.3.2.6 Create and Update with a One-To-Many Relationship",day:"tuesday",id:"3-3-2-6-create-and-update-with-a-one-to-many-relationship",hide_table_of_contents:!0},r=void 0,d={},l=[{value:"Using ViewBag for <code>Category</code> Data in the <code>ItemsController</code>",id:"using-viewbag-for-category-data-in-the-itemscontroller",level:2},{value:"Updating <code>Item</code> Create and Edit Views",id:"updating-item-create-and-edit-views",level:3},{value:"Listing the <code>Category</code> on the <code>Item</code> Details Page",id:"listing-the-category-on-the-item-details-page",level:3},{value:"Preventing Database Errors",id:"preventing-database-errors",level:3},{value:"Repository Reference",id:"repository-reference",level:3}];function c(e){const t={a:"a",code:"code",div:"div",h2:"h2",h3:"h3",hr:"hr",i:"i",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(t.p,{children:["Now it's time to update the rest of our application so that our users can actually associate a ",(0,a.jsx)(t.code,{children:"Category"})," with an ",(0,a.jsx)(t.code,{children:"Item"}),". We'll also make two other valuable updates: we'll list the ",(0,a.jsx)(t.code,{children:"Category"})," that an ",(0,a.jsx)(t.code,{children:"Item"})," belongs to on its details page, and we'll make an update to our CREATE action to prevent unhandled database errors."]}),"\n",(0,a.jsxs)(t.h2,{id:"using-viewbag-for-category-data-in-the-itemscontroller",children:["Using ViewBag for ",(0,a.jsx)(t.code,{children:"Category"})," Data in the ",(0,a.jsx)(t.code,{children:"ItemsController"})]}),"\n",(0,a.jsx)(t.hr,{}),"\n",(0,a.jsxs)(t.p,{children:["Let's now use ViewBag to get ",(0,a.jsx)(t.code,{children:"Category"})," data into our ",(0,a.jsx)(t.code,{children:"Item"})," Views. We will be updating our example To Do List project with the following changes. In this example, we'll access ViewBag data from an HTML helper, and the syntax in the View will look different than what we've seen so far."]}),"\n",(0,a.jsxs)(t.p,{children:["We will need ",(0,a.jsx)(t.code,{children:"Category"})," data in two of our ",(0,a.jsx)(t.code,{children:"Item"})," routes, so let's update those two methods in ",(0,a.jsx)(t.code,{children:"ItemsController"})," so that they use ViewBag. Here are the two methods we need to update:"]}),"\n",(0,a.jsx)(t.div,{className:"filename",children:"Controllers/ItemsController.cs"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-csharp",children:'using Microsoft.AspNetCore.Mvc.Rendering;\n\n...\n\npublic ActionResult Create()\n{\n  ViewBag.CategoryId = new SelectList(_db.Categories, "CategoryId", "Name");\n  return View();\n}\n\n...\n\npublic ActionResult Edit(int id)\n{\n  Item thisItem = _db.Items.FirstOrDefault(item => item.ItemId == id);\n  ViewBag.CategoryId = new SelectList(_db.Categories, "CategoryId", "Name");\n  return View(thisItem);\n}\n\n...\n'})}),"\n",(0,a.jsxs)(t.p,{children:["First we add the necessary using directive so that we have access to ",(0,a.jsx)(t.code,{children:"SelectList"}),". Now note that both methods have the following lines added to them:"]}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-csharp",children:'ViewBag.CategoryId = new SelectList(_db.Categories, "CategoryId", "Name");\n'})}),"\n",(0,a.jsxs)(t.p,{children:["When we create and edit our items, we want them to belong to categories that already exist. We do this by creating a ",(0,a.jsx)(t.code,{children:"ViewBag.CategoryId"})," property  in the ",(0,a.jsx)(t.code,{children:"Create"})," and ",(0,a.jsx)(t.code,{children:"Edit"})," GET actions, and assigning it as a new ",(0,a.jsx)(t.code,{children:"SelectList"})," object."]}),"\n",(0,a.jsxs)(t.p,{children:["A ",(0,a.jsx)(t.code,{children:"SelectList"})," will provide a list of the data needed to create an html ",(0,a.jsx)(t.code,{children:"<select>"})," list of all the categories from our database. The displayed text of each ",(0,a.jsx)(t.code,{children:"<option>"})," will be the ",(0,a.jsx)(t.code,{children:"Category"}),"'s ",(0,a.jsx)(t.code,{children:"Name"})," property, and the value of the ",(0,a.jsx)(t.code,{children:"<option>"})," will be the ",(0,a.jsx)(t.code,{children:"Category"}),"'s ",(0,a.jsx)(t.code,{children:"CategoryId"}),".  That way, a user can select an ",(0,a.jsx)(t.code,{children:"Category"})," from the dropdown to associate with the ",(0,a.jsx)(t.code,{children:"Item"})," we are creating or editing."]}),"\n",(0,a.jsxs)(t.p,{children:["The ",(0,a.jsx)(t.code,{children:"SelectList"})," takes multiple arguments:"]}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsxs)(t.li,{children:["The first argument represents the data that will populate our SelectList's ",(0,a.jsx)(t.code,{children:"<option>"})," elements: a list of categories from our database."]}),"\n",(0,a.jsxs)(t.li,{children:["The second argument is the value of the every ",(0,a.jsx)(t.code,{children:"<option>"})," element: the ",(0,a.jsx)(t.code,{children:"Category"}),"'s ",(0,a.jsx)(t.code,{children:"CategoryId"}),"."]}),"\n",(0,a.jsxs)(t.li,{children:["The third argument is the displayed text of every ",(0,a.jsx)(t.code,{children:"<option>"})," element: the name of the ",(0,a.jsx)(t.code,{children:"Category"}),"."]}),"\n"]}),"\n",(0,a.jsxs)(t.h3,{id:"updating-item-create-and-edit-views",children:["Updating ",(0,a.jsx)(t.code,{children:"Item"})," Create and Edit Views"]}),"\n",(0,a.jsx)(t.p,{children:"Next, let's update the corresponding views:"}),"\n",(0,a.jsx)(t.div,{className:"filename",children:"Views/Items/Create.cshtml"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-html",children:'@{\n  Layout = "_Layout";\n}\n\n@model ToDoList.Models.Item\n\n<h4>Add a new item</h4>\n\n@using (Html.BeginForm())\n{\n  @Html.LabelFor(model => model.Description)\n  @Html.TextBoxFor(model => model.Description)\n\n  @Html.LabelFor(model => model.Category)\n  @Html.DropDownList("CategoryId")\n\n  <input type="submit" value="Add new item" class="btn btn-primary" />\n}\n<p>@Html.ActionLink("Show all items", "Index")</p>\n'})}),"\n",(0,a.jsx)(t.div,{className:"filename",children:"Views/Items/Edit.cshtml"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-html",children:'@{\n  Layout = "_Layout";\n}\n\n@model ToDoList.Models.Item\n\n<h2>Edit</h2>\n\n<h4>Edit this item: @Html.DisplayFor(model => model.Description)</h4>\n\n@using (Html.BeginForm())\n{\n  @Html.HiddenFor(model => model.ItemId)\n\n  @Html.LabelFor(model => model.Description)\n  @Html.EditorFor(model => model.Description)\n\n  @Html.LabelFor(model => model.Category)\n  @Html.DropDownList("CategoryId")\n\n  <input type="submit" value="Save" />\n}\n\n<p>@Html.ActionLink("Back to list", "Index")</p>\n'})}),"\n",(0,a.jsx)(t.p,{children:"Note that we've added the following two lines to both views:"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-cs",children:'@Html.LabelFor(model => model.Category)\n@Html.DropDownList("CategoryId")\n'})}),"\n",(0,a.jsxs)(t.p,{children:["We use an HTML helper method called ",(0,a.jsx)(t.code,{children:"DropDownList()"}),", we give ",(0,a.jsx)(t.code,{children:"DropDownList()"})," the string name of a ViewBag property of the type ",(0,a.jsx)(t.code,{children:"SelectList"}),". Since we saved our SelectList as ",(0,a.jsx)(t.code,{children:"ViewBag.CategoryId"}),", we give ",(0,a.jsx)(t.code,{children:"DropDownList()"})," the string ",(0,a.jsx)(t.code,{children:'"CategoryId"'}),". This helper method will create an html dropdown select list out of the ",(0,a.jsx)(t.code,{children:"SelectList"})," object."]}),"\n",(0,a.jsxs)(t.p,{children:[(0,a.jsx)(t.strong,{children:"Note"})," \u2014 ",(0,a.jsx)(t.code,{children:"CategoryId"})," may seem like a bad name for a ",(0,a.jsx)(t.code,{children:"SelectList"})," object, but the reason we chose that name is because that will be the ",(0,a.jsx)(t.code,{children:"name"})," attribute on the ",(0,a.jsx)(t.code,{children:"<select>"})," tag created. You can check this in your browser DevTools Inspector and see ",(0,a.jsx)(t.code,{children:'<select id="CategoryId" name="CategoryId">'}),". We could use a different name like ",(0,a.jsx)(t.code,{children:"ViewBag.CategoryList"})," and you'd get ",(0,a.jsx)(t.code,{children:'<select id="CategoryList" name="CategoryList">'}),". The problem with that is when we submit our form it will use the ",(0,a.jsx)(t.code,{children:"name"})," attribute to know what property of the ",(0,a.jsx)(t.code,{children:"Item"})," object to assign a value, so it will try to create an Item with a ",(0,a.jsx)(t.code,{children:"CategoryList"})," property, which will not work."]}),"\n",(0,a.jsxs)(t.h3,{id:"listing-the-category-on-the-item-details-page",children:["Listing the ",(0,a.jsx)(t.code,{children:"Category"})," on the ",(0,a.jsx)(t.code,{children:"Item"})," Details Page"]}),"\n",(0,a.jsxs)(t.p,{children:["Next, let's list the name of the ",(0,a.jsx)(t.code,{children:"Category"})," on the details page for an ",(0,a.jsx)(t.code,{children:"Item"}),". First, we'll update the ",(0,a.jsx)(t.code,{children:"Details"})," action in the ",(0,a.jsx)(t.code,{children:"ItemsController"})," to grab include the ",(0,a.jsx)(t.code,{children:"Category"})," when it gets the ",(0,a.jsx)(t.code,{children:"Item"})," from the database:"]}),"\n",(0,a.jsx)(t.div,{className:"filename",children:"Controllers/ItemsController.cs"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-csharp",children:"...\n\n    public ActionResult Details(int id)\n    {\n      Item thisItem = _db.Items\n                          .Include(item => item.Category)\n                          .FirstOrDefault(item => item.ItemId == id);\n      return View(thisItem);\n    }\n\n...\n"})}),"\n",(0,a.jsxs)(t.p,{children:["Then, we'll update the corresponding view to display the ",(0,a.jsx)(t.code,{children:"Category"})," name:"]}),"\n",(0,a.jsx)(t.div,{className:"filename",children:"Views/Items/Details.cshtml"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-html",children:'@{\n  Layout = "_Layout";\n}\n\n@model ToDoList.Models.Item\n\n<h2>Item Details</h2>\n<hr />\n<h3>@Html.DisplayNameFor(model => model.Description): @Html.DisplayFor(model => model.Description)<h3>\n<h3>@Html.DisplayNameFor(model => model.Category): @Html.DisplayFor(model => model.Category.Name)<h3>\n\n<p>@Html.ActionLink("Edit Item", "Edit", new { id = Model.ItemId })</p>\n<p>@Html.ActionLink("Delete Item", "Delete", new { id = Model.ItemId })</p>\n<p>@Html.ActionLink("Back to list", "Index")</p>\n'})}),"\n",(0,a.jsx)(t.h3,{id:"preventing-database-errors",children:"Preventing Database Errors"}),"\n",(0,a.jsxs)(t.p,{children:["Users will see an unhandled error in the browser when they try to create an ",(0,a.jsx)(t.code,{children:"Item"})," without there being a ",(0,a.jsx)(t.code,{children:"Category"})," they can associate the ",(0,a.jsx)(t.code,{children:"Item"})," with. That's because our database expects each ",(0,a.jsx)(t.code,{children:"Item"})," to have a valid ",(0,a.jsx)(t.code,{children:"CategoryId"}),", and without it, our application breaks. That means we need to update our application to prevent this from happening. There's quite a few ways we can do this, and we'll implement a basic solution for this issue now. In the next course section, we'll learn how to solve this issue with a different tool."]}),"\n",(0,a.jsxs)(t.p,{children:["Our basic solution is to add an instruction for the user to read to let them know they need to add a Category before they create an Item. Then, in the controller, we'll check to see if a ",(0,a.jsx)(t.code,{children:"Category"})," has been added, and if not, redirect back to the ",(0,a.jsx)(t.code,{children:"Create"})," page."]}),"\n",(0,a.jsxs)(t.p,{children:["Let's start with the instruction to the user. In ",(0,a.jsx)(t.code,{children:"Views/Items/Create.cshtml"}),", add the following code right before the ",(0,a.jsx)(t.code,{children:"<h4>"})," tag and above the form:"]}),"\n",(0,a.jsx)(t.div,{className:"filename",children:"Views/Items/Create.cshtml"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-html",children:'...\n\n<p><strong>NOTE:</strong> You need to have at least one category before you can add an item!</p>\n<p>Go to @Html.ActionLink("this page", "Create", "Categories") to create a category.</p>\n\n...\n'})}),"\n",(0,a.jsxs)(t.p,{children:["Next, let's update the ",(0,a.jsx)(t.code,{children:"Create"})," POST action within the ",(0,a.jsx)(t.code,{children:"ItemsController.cs"})," to check whether a Category has been selected for the ",(0,a.jsx)(t.code,{children:"Item"}),"."]}),"\n",(0,a.jsxs)(t.p,{children:["Here's the updated ",(0,a.jsx)(t.code,{children:"Create"})," POST action:"]}),"\n",(0,a.jsx)(t.div,{className:"filename",children:"Views/ItemsController.cs"}),"\n",(0,a.jsx)(t.pre,{children:(0,a.jsx)(t.code,{className:"language-csharp",children:'...\n\n    [HttpPost]\n    public ActionResult Create(Item item)\n    {\n      if (item.CategoryId == 0)\n      {\n        return RedirectToAction("Create");\n      }\n      _db.Items.Add(item);\n      _db.SaveChanges();\n      return RedirectToAction("Index");\n    }\n\n...\n'})}),"\n",(0,a.jsxs)(t.p,{children:["We've added a new ",(0,a.jsx)(t.code,{children:"if"})," statement that checks the value of ",(0,a.jsx)(t.code,{children:"CategoryId"}),". By default, the ",(0,a.jsx)(t.code,{children:"CategoryId"})," will be ",(0,a.jsx)(t.code,{children:"0"})," if no Category is selected in the form. So, we can check if ",(0,a.jsx)(t.code,{children:"CategoryId"})," is set to ",(0,a.jsx)(t.code,{children:"0"}),", and if so, redirect to the ",(0,a.jsx)(t.code,{children:"Create"})," GET action and view."]}),"\n",(0,a.jsxs)(t.p,{children:["Again, this is just solution to our issue here. In the next section, we'll learn about validating models through ",(0,a.jsx)(t.strong,{children:"validation attributes"})," that we can add to our model's properties. We'll get into that soon!"]}),"\n",(0,a.jsxs)(t.p,{children:["At this point, we've successfully set up a one-to-many relationship. We've also added very basic protection to our application to not create an item unless there's a category that it can be associated with. We can run our application and make an association between an ",(0,a.jsx)(t.code,{children:"Item"})," and a ",(0,a.jsx)(t.code,{children:"Category"})," via a dropdown."]}),"\n",(0,a.jsxs)(t.p,{children:["For further information on using Entity, check out ",(0,a.jsx)(t.a,{href:"https://docs.microsoft.com/en-us/ef/core/modeling/relationships",children:"Microsoft's documentation on Entity Framework Core"}),"."]}),"\n",(0,a.jsx)(t.h3,{id:"repository-reference",children:"Repository Reference"}),"\n",(0,a.jsxs)(t.p,{children:["Follow the link below to view the ",(0,a.jsx)(t.strong,{children:"finished project"})," for the walkthrough of creating a To Do List app that uses EF Core to communicate with a MySQL database. Note that this is a link to a specific branch in the repository."]}),"\n",(0,a.jsx)(t.p,{children:(0,a.jsx)(t.strong,{children:(0,a.jsxs)(t.a,{href:"https://github.com/epicodus-lessons/section-3-to-do-list-with-ef-core-csharp-net6/tree/4_one_to_many_relationship",children:[(0,a.jsx)(t.i,{className:"glyphicon glyphicon-folder-open"})," Example GitHub Repo for To Do List with EF Core: 4_one_to_many_relationship"]})})})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}}}]);